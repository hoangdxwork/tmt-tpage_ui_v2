
<tds-tabset [tabBarStyle]="{ 'padding':'0', 'overflow': 'hidden' }" class="tab-live-campaign border-t pt-2">
    <tds-tab title="Sản phẩm" [clsContent]="'p-0 w-full h-full flex'">
            <div class="w-full h-full flex flex-col overflow-hidden">
                <div class="w-full flex gap-x-2 mt-2 px-1">
                    <div class="relative flex flex-auto">
                        <tds-form-field class="w-full">
                            <input tdsInput placeholder="Nhập tên sản phẩm" autocomplete="off" [tdsInputDebounce]="750"
                                [(ngModel)]="innerText" [ngModelOptions]="{standalone: true}"
                                (inputKeyup)="onFilterIndexDB($event)">

                            <span tdsPrefix><i class="text-neutral-1-500 tdsi-search-fill"></i></span>

                            <span *ngIf="innerText" tdsSuffix>
                                <i (click)="closeFilterIndexDB()" class="text-neutral-1-500 tdsi-close-fill"></i>
                            </span>
                        </tds-form-field>

                        <div *ngIf="innerText && indexDbStorage && indexDbStorage.length > 0; else noDataProduct"
                            class="absolute left-0 right-0 -bottom-2 top-full h-[400px] z-10 bg-white shadow-md">
                            <tds-table #basicTable [listData]="indexDbStorage | filterindexdblive: innerTextDebounce"
                                [scroll]="{ y:'100%', x:'hidden' }" [showPagination]="false" [frontPagination]="false"
                                [virtualItemSize]="20" [loading]="isLoadingProduct" [virtualForTrackBy]="trackByIndex">
                                <tbody>
                                    <ng-template tds-virtual-scroll let-data let-index="index">
                                        <tr *ngIf="data" (click)="selectProduct(data, index)" tds-popover
                                            popoverTrigger="click" [popoverVisible]="index == indClick"
                                            [popoverBackdrop]="true"
                                            (popoverVisibleChange)="onPopoverVisibleChange($event)"
                                            [popoverContent]="(lstVariants && lstVariants.length > 1) ? contentTemplate : undefined"
                                            [popoverAutoClose]="true" class="group hover:cursor-pointer"
                                            [style.background-color]="(index == indClick) ? '#f0f0f0' : ''">
                                            <td>
                                                <span class="text-body-2 w-full truncate" tds-tooltip tooltipTitle="{{ data.NameGet }}">
                                                    <span>{{ data.NameGet }}</span> - <span class="text-primary-1">{{ data.Price | numberCustom }} đ</span>
                                                </span>
                                                <div class="w-full">
                                                    <span class="text-neutral-1-400 font-regular text-[13px]"> Tồn kho:
                                                        <span class="text-primary-1">{{ (lstInventory && lstInventory[data.Id]) ? lstInventory[data.Id].QtyAvailable : 0 }}</span>
                                                    </span>
                                                    <span class="ml-1 mr-1"> / </span>
                                                    <span class="text-neutral-1-400 font-regular text-[13px]"> Tồn dự báo:
                                                        <span class="text-primary-1">{{ (lstInventory && lstInventory[data.Id]) ? lstInventory[data.Id].VirtualAvailable : 0 }}</span>
                                                    </span>
                                                </div>
                                            </td>
                                        </tr>

                                        <ng-template #contentTemplate>
                                            <tds-spin [spinning]="isLoadingSelect" class="flex flex-col gap-y-2">
                                                <div class="text-body-2 font-semibold">
                                                    Bạn có muốn chọn tất cả {{ lstVariants.length }} biến thể cùng với sản phẩm này.
                                                </div>

                                                <div class="flex items-center justify-end gap-x-2 pt-4">
                                                    <button *ngIf="lstVariants.length > 1" tds-button size="sm" (click)="getVariant()" type="button">
                                                        Chọn tất cả
                                                    </button>
                                                    <button tds-button color="secondary" size="sm" (click)="getVariant(data)" type="button">
                                                        Chọn hiện tại
                                                    </button>
                                                </div>
                                            </tds-spin>
                                        </ng-template>
                                    </ng-template>
                                </tbody>
                            </tds-table>
                        </div>

                        <ng-template #noDataProduct>
                            <div *ngIf="innerText"
                                class="absolute left-0 right-0 -bottom-2 top-full p-2 h-44 overflow-hidden z-10 bg-white shadow-md">
                                <tds-spin [spinning]="isLoadingProduct">
                                    <tds-empty></tds-empty>
                                </tds-spin>
                            </div>
                        </ng-template>
                    </div>

                    <button tds-button-icon color="primary" size="md" type="button" tds-tooltip="Thêm mới sản phẩm" (click)="showCreateProductModal()">
                        <i class="tdsi-plus-fill text-lg leading-none"></i>
                    </button>
                </div>

                <div class="w-full flex flex-col mt-2 rounded-md">
                    <tds-table [listData]="lstDetail" [showPagination]="false">
                        <thead>
                            <tr>
                                <th class="flex flex-row items-center justify-between">
                                    <div customFilter class="flex justify-between items-center w-full">
                                        <div class="flex-auto flex items-center gap-x-2">
                                            <button type="button" *ngIf="!visible; else menu" (click)="onOpenSearchvalue()">
                                                <span class="tdsi-search-fill p-1 rounded text-neutral-1-500 text-base leading-none relative flex items-center"
                                                    tds-tooltip="Tìm kiếm sản phẩm trong danh sách">
                                                </span>
                                            </button>

                                            <span *ngIf="!visible" class="w-full py-2 h-[34px]"> Sản phẩm ({{ count || 0 }})</span>
                                        </div>

                                        <ng-template #menu>
                                            <div class="w-3/4">
                                                <tds-form-field class="w-full font-normal">
                                                    <input type="text" tdsInput placeholder="Nhập tên, mã code..." #innerText
                                                        [tdsInputDebounce]="500" (inputKeyup)="onSearch($event)"
                                                        autocomplete="off" [(ngModel)]="innerTextValue"
                                                        [ngModelOptions]="{standalone: true}" />
                                                    <span tdsSuffix (click)="refreshData()"><i
                                                            class="tdsi-close-fill"></i></span>
                                                </tds-form-field>
                                            </div>
                                        </ng-template>
                                    </div>

                                    <div class="flex flex-auto gap-x-1">

                                        <button type="button" tds-button-icon color="secondary" size="sm" (click)="showIsActiveProduct()"
                                            tds-tooltip tooltipTitle="Bật tắt hoạt động sản phẩm"
                                            tds-popover popoverTrigger="click" [(popoverVisible)]="isShowIsActiveProduct"
                                            [popoverAutoClose]="true" [popoverContent]="contentTemplateIsActive">
                                            <span class="flex items-center text-neutral-1-500">
                                                <i class="tdsi-maintenance-fill"></i>
                                            </span>
                                        </button>

                                        <button type="button" tds-button-icon color="secondary" size="sm" (click)="showEditLimitedQuantity()"
                                            tds-tooltip tooltipTitle="Chỉnh sửa giới hạn trên đơn cho tất cả sản phẩm"
                                            tds-popover  popoverTrigger="click" [(popoverVisible)]="isShowEditLimitedQuantity" (popoverVisibleChange)="onPopoverApplyLimitQuantityChange($event)"
                                            [popoverAutoClose]="false" [popoverFooter]="footerTemplate" [popoverContent]="contentTemplate">
                                            <span class="flex items-center text-neutral-1-500">
                                                <i class="tdsi-edit-2-fill"></i>
                                            </span>
                                        </button>

                                        <button type="button" tds-button-icon color="secondary" size="sm"
                                            (click)="refreshData()" tds-tooltip tooltipTitle="Reload">
                                            <span class="flex items-center text-neutral-1-500">
                                                <i class="tdsi-loading-fill"></i>
                                            </span>
                                        </button>
                                    </div>
                                </th>
                            </tr>
                        </thead>
                    </tds-table>
                </div>
                <tds-spin [spinning]="isLoading" class="flex flex-col overflow-hidden overflow-y-auto w-full h-full">
                    <virtual-scroller *ngIf="lstDetail && lstDetail.length > 0; else noData"
                        #scroll [items]="lstDetail" class="tds-custom-scroll w-full h-full"
                        (vsEnd)="vsEnd($event)"
                        (vsStart)="vsStart($event)"
                        [enableUnequalChildrenSizes]="true"
                        [scrollAnimationTime]="500"
                        [scrollThrottlingTime]="350">
                        <div *ngFor="let data of scroll.viewPortItems; let i = index" class="flex w-full overflow-hidden laptop:text-caption-1 tablet:text-caption-1">
                            <div [ngClass]="{'bg-primary-3':(isEditDetails[data.Id] && liveCampaignId)}" class="p-2 w-full border-t block hover:bg-neutral-3-50 hover:cursor-pointer">
                                <div class="mb-1 inline-block w-full">
                                    <div class="flex-auto flex flex-col gap-y-1">
                                        <div class="w-full flex gap-x-2 justify-between items-center">
                                            <span class="font-semibold text-[13px] w-full laptop:max-w-[100px] tablet:max-w-[100px] truncate mr-2">
                                                <span *ngIf="data.Tags?.length > 0" tds-popover [popoverContent]="popoverTag" popoverPlacement="topLeft"
                                                  tds-tooltip="{{ data.ProductNameGet || data.ProductName}}"  tooltipPlacement="bottomLeft">
                                                  {{ data.ProductNameGet || data.ProductName }}
                                                </span>
                                                <span *ngIf="data.Tags?.length == 0" tds-tooltip="{{ data.ProductNameGet || data.ProductName}}"  tooltipPlacement="topLeft">
                                                  {{ data.ProductNameGet || data.ProductName }}
                                              </span>
                                            </span>

                                            <!-- Thao tác -->
                                            <div class="text-center flex justify-end items-center gap-x-1 w-1/4">
                                                <div *ngIf="!isEditDetails[data.Id]">
                                                    <tds-checkbox size="sm" tds-tooltip="Bật/tắt sản phẩm" [(ngModel)]="data.IsActive" (change)="onChecked($event, data)"></tds-checkbox>
                                                </div>

                                                <button *ngIf="!isEditDetails[data.Id]" tds-button-flat-icon [size]="'sm'" color="secondary" tds-tooltip="Chỉnh sửa" (click)="onEditDetails(data)">
                                                    <i class="tdsi-edit-fill"></i>
                                                </button>

                                                <button *ngIf="!isEditDetails[data.Id]" tds-button-flat-icon [size]="'sm'" color="secondary" tds-tooltip="Xóa" (click)="removeDetail(data)">
                                                    <i class="tdsi-trash-fill"></i>
                                                </button>

                                                <button *ngIf="isEditDetails[data.Id]" tds-button-icon size="sm" color="primary" tds-tooltip="Áp dụng" (click)="onSaveDetails(data)">
                                                    <span class="flex items-center">
                                                        <i class="tdsi-tick-fill"></i>
                                                    </span>
                                                </button>

                                                <button *ngIf="isEditDetails[data.Id]" tds-button-icon size="sm" color="secondary" tds-tooltip="Bỏ chỉnh sửa" (click)="onCloseDetail(data)">
                                                    <span class="flex items-center">
                                                        <i class="tdsi-close-fill"></i>
                                                    </span>
                                                </button>
                                            </div>
                                        </div>

                                        <ng-template #popoverTag>
                                            <div class="max-w-[320px]">
                                                <div class="flex flex-wrap gap-1 items-center">
                                                    <div *ngFor="let item of (data.Tags | stringToStringArray)">
                                                        <tds-tag class="mr-1 cursor-pointer text-[13px]" status='primary'>
                                                            {{ (item || '') }}
                                                        </tds-tag>
                                                    </div>
                                                </div>
                                            </div>
                                        </ng-template>

                                        <!-- <div *ngIf="data?.AttributeValues?.length > 0" class="flex items-center gap-x-1 mb-1">
                                            <div *ngFor="let itemsAttributes of ( data?.TagWithAttributes | stringToStringArray)">
                                              <tds-tag class="cursor-pointer text-[13px]" status='secondary'>{{ itemsAttributes }}</tds-tag>
                                            </div>
                                        </div> -->

                                        <!-- Tags -->
                                        <div *ngIf="isEditDetails[data.Id]" class="flex items-center flex-wrap gap-x-1">
                                            <span *ngIf="data.Tags?.length <= 0"
                                                class="text-info-500 font-normal text-sm cursor-pointer"
                                                (click)="openTag(data)" tds-popover
                                                [popoverVisible]="indClickTag == i"
                                                popoverTrigger="click" [popoverContent]="contentAddtag"
                                                [popoverFooter]="footerAddTag" [popoverBackdrop]="true"
                                                [popoverAutoClose]="true" popoverPlacement="left">+Thêm cú pháp chốt đơn</span>

                                            <div class="flex flex-wrap gap-2 items-center" *ngIf="data.Tags?.length > 0">
                                                <button type="button"
                                                    (click)="openTag(data)" tds-popover
                                                    [popoverVisible]="indClickTag == i"
                                                    popoverTrigger="click" [popoverContent]="contentAddtag"
                                                    [popoverFooter]="footerAddTag" [popoverBackdrop]="true"
                                                    [popoverAutoClose]="true" popoverPlacement="left"
                                                    tds-tooltip tooltipTitle="Thêm cú pháp chốt đơn"
                                                    color="custom" size="sm"
                                                    class="bg-transparent border-0 focus:ring-transparent">

                                                    <div class="w-5 h-5 relative">
                                                        <i class="tdsi-tag-fill text-neutral-1-500 text-base leading-4 select-all absolute top-0 left-0"></i>
                                                        <svg class="border border-white bg-white rounded-full absolute bottom-0 right-0" width="12" height="12" viewBox="0 0 11 11" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                            <path d="M6.00263 0.185353C5.78089 0.14704 5.55607 0.129611 5.3311 0.133295C3.96134 0.134421 2.64803 0.680863 1.67966 1.65259C0.711296 2.62431 0.167057 3.94186 0.166496 5.3158C0.162824 5.54146 0.180199 5.76697 0.218396 5.98938C0.342953 6.94846 0.732804 7.85338 1.34378 8.60162C1.95476 9.34986 2.76244 9.91151 3.67532 10.2229C4.5882 10.5344 5.56979 10.5831 6.50889 10.3637C7.44798 10.1443 8.30703 9.66541 8.98873 8.98138C9.67042 8.29736 10.1475 7.4355 10.3659 6.49346C10.5843 5.55142 10.5354 4.56685 10.2246 3.65129C9.91374 2.73574 9.3535 1.92579 8.60732 1.31322C7.86114 0.70065 6.95883 0.309939 6.00263 0.185353ZM8.09029 5.79283H5.80879V8.08342H4.85553V5.79283H2.57403V4.83665H4.85764V2.53756H5.81091V4.83878H8.09452L8.09029 5.79283Z" fill="#28A745" />
                                                        </svg>
                                                    </div>
                                                </button>

                                                <div *ngFor="let item of (data.Tags | stringToStringArray)" tds-tooltip [tooltipTitle]="item">
                                                    <span class="mb-1 cursor-pointer text-caption-1 bg-neutral-3-100 text-neutral-1-700 rounded px-2 py-0.5 font-semibold" status='secondary'>
                                                        {{ (item || '') | truncateString }}
                                                    </span>
                                                </div>
                                            </div>

                                            <!-- button thêm nhãn -->
                                            <ng-template #contentAddtag>
                                                <div class="w-[360px]">
                                                    <tds-form-field>
                                                        <tds-select [(ngModel)]="modelTags"
                                                            [ngModelOptions]="{standalone: true}"
                                                            placeholder='Nhập và chọn Tag' mode="tags"
                                                            [allowClear]="true" [autoClose]="true"
                                                            [valuePrimitive]="false"
                                                            (selectChange)="onChangeModelTag($event, data)"
                                                            [data]="(data.Tags | stringToStringArray)">
                                                        </tds-select>
                                                    </tds-form-field>
                                                </div>
                                            </ng-template>

                                            <ng-template #footerAddTag>
                                                <div class="flex justify-end pt-2">
                                                    <button tds-button-icon color="secondary" class="mr-2"
                                                        size="sm" (click)="onCloseTag()" type="button">
                                                        <span class="flex items-center">
                                                            <i class="tdsi-close-fill"></i>
                                                        </span>
                                                    </button>
                                                    <button tds-button-icon size="sm" color="primary"
                                                        (click)="onSaveTag(data)" type="button">
                                                        <span class="flex items-center">
                                                            <i class="tdsi-checkbox-check-fill"></i>
                                                        </span>
                                                    </button>
                                                </div>
                                            </ng-template>
                                        </div>

                                    </div>
                                </div>

                                <!-- Danh sách order tag -->
                                <div *ngIf="orderTags && orderTags[data.ProductId + '_' + data.UOMId] && orderTags[data.ProductId + '_' + data.UOMId].length > 0" class="flex flex-wrap items-center gap-1">
                                    <tds-tag status='secondary' class="cursor-pointer hover:opacity-75" size="sm" tds-tooltip="{{ orderTag }}"
                                        *ngFor="let orderTag of orderTags[data.ProductId + '_' + data.UOMId]| slice:0:2">
                                        <div class="2xl:max-w-[105px] xl:max-w-[55px] w-fit truncate">{{ orderTag }}</div>
                                    </tds-tag>

                                    <div class="flex gap-1.5 items-center" *ngIf="orderTags[data.ProductId + '_' + data.UOMId].length > 2">
                                        <div class="px-1 py-0.5 text-info-500 bg-[#E5F2FF] text-caption-2 rounded truncate cursor-pointer tdsi-plus-fill" tds-popover
                                            [popoverContent]="popoverContentTag"
                                            popoverPlacement="top"
                                            [popoverBackdrop]="true">
                                        </div>

                                        <ng-template #popoverContentTag>
                                            <div class="flex gap-x-2 gap-y-1 flex-wrap max-w-[500px]">
                                                <div *ngFor="let orderTag2 of orderTags[data.ProductId + '_' + data.UOMId]"
                                                    class="relative flex items-center text-caption-2 text-[11px] font-regular text-neutral-1-900 rounded truncate flex-none">
                                                    <tds-tag status='secondary' class="cursor-pointer" size="sm" tds-tooltip="{{ orderTag2 }}">
                                                        <div class="max-w-[230px] w-fit truncate">{{ orderTag2 }}</div>
                                                    </tds-tag>
                                                </div>
                                            </div>
                                        </ng-template>
                                    </div>
                                </div>

                                <div class="flex flex-row items-center justify-between w-full mb-1">
                                    <!-- Trạng thái  -->
                                    <!-- <div class="flex mb-1">
                                        <span class="flex items-center pr-2">Trạng thái:</span>
                                        <div class="flex flex-auto">
                                            <div *ngIf="isEditDetails[data.Id]" class="w-[70%]">
                                                <tds-checkbox [(ngModel)]="data.IsActive">
                                                </tds-checkbox>
                                            </div>
                                            <div *ngIf="!isEditDetails[data.Id] && data.IsActive"
                                                class="text-body-2 text-secondary-1" style="font-style: italic;">
                                                Hoạt động
                                            </div>
                                            <div *ngIf="!isEditDetails[data.Id] && !data.IsActive"
                                                class="text-body-2 text-accent-3" style="font-style: italic;">
                                                Đã tắt
                                            </div>
                                        </div>
                                    </div> -->

                                    <!-- Số lượng chốt -->
                                    <div class="flex item-center gap-x-2 text-body-2 laptop:flex-col tablet:flex-col mt-1">
                                        <div class="text-neutral-1-500 flex items-center hover:underline hover:text-info-500"
                                            tds-tooltip="Click xem đơn hàng chờ chốt" (click)="showModalLiveCampaignOrder(data)">
                                            Chờ chốt:&nbsp;
                                            <span class="mr-0.5">{{ (data.QueueQuantity || 0) | numberCustom }}</span>
                                            <tds-spinner
                                                [ngClass]="animateSocket[data.ProductId + '_' + data.UOMId + '_queueQty'] ? 'visible' : 'invisible'"
                                                [color]="'error'" class="w-2.5 h-2.5"></tds-spinner>
                                        </div>
                                        <div class="laptop:hidden tablet:hidden">/</div>
                                        <div class="text-neutral-1-500 flex items-center  hover:underline hover:text-info-500"
                                            tds-tooltip="Click xem hóa đơn đã chốt" (click)="showModalLiveCampaignBill(data)">
                                            Đã chốt:&nbsp;
                                            <span class="mr-0.5">{{ (data.UsedQuantity || 0) | numberCustom }}</span>
                                            <tds-spinner
                                                [ngClass]="animateSocket[data.ProductId + '_' + data.UOMId + '_usedQty'] ? 'visible' : 'invisible'"
                                                [color]="'error'" class="ml-1 w-2.5 h-2.5"></tds-spinner>
                                        </div>
                                    </div>
                                    <div class="flex items-center"
                                        [ngClass]="data.RemainQuantity > 10 ? 'text-info-400' : 'text-error-400'">
                                        Còn lại:&nbsp;
                                        <span class="font-semibold">{{ (((data.Quantity - data.UsedQuantity) || 0) | numberCustom) }}</span>
                                        <tds-spinner
                                            [ngClass]="animateSocket[data.ProductId + '_' + data.UOMId + '_queueQty']
                                                || animateSocket[data.ProductId + '_' + data.UOMId + '_usedQty'] ? 'visible' : 'invisible'"
                                            [color]="'error'" class="w-2.5 h-2.5"></tds-spinner>
                                    </div>
                                </div>
                                <div class="grid desktop:grid-cols-2 laptop:grid-cols-1 tablet:grid-cols-1 w-full items-center mb-1 desktop:gap-2 justify-center">
                                    <!-- Giá bán -->
                                    <div class="flex flex-col items-center gap-y-1 w-full" *ngIf="isEditDetails[data.Id]">
                                        <span class="flex pr-2 w-full">Giá</span>
                                        <tds-form-field class="w-full">
                                            <tds-input-number [min]="0" [step]="1000" size="sm" class="w-full"
                                                [(ngModel)]="data.Price" [ngModelOptions]="{standalone: true}"
                                                [formatter]="numberWithCommas" [parser]="parserComas">
                                            </tds-input-number>
                                        </tds-form-field>
                                    </div>

                                    <div *ngIf="isEditDetails[data.Id]" class="w-full flex flex-col gap-y-1">
                                        <!-- Giới hạn trên đơn -->
                                        <span class="flex truncate">Giới hạn trên đơn</span>
                                        <tds-form-field class="w-full">
                                            <tds-input-number [min]="0" [max]="1000000000" [step]="1" size="sm" class="w-full"
                                                [(ngModel)]="data.LimitedQuantity" [ngModelOptions]="{standalone: true}"
                                                [formatter]="numberWithCommas" [parser]="parserComas">
                                            </tds-input-number>
                                        </tds-form-field>
                                    </div>

                                    <div *ngIf="isEditDetails[data.Id]" class="w-full flex flex-col items-center gap-y-1">
                                        <!-- Số lượng -->
                                        <span class="flex pr-2 w-full truncate">Số lượng</span>
                                        <tds-form-field class="w-full">
                                            <tds-input-number [min]="0" [step]="1" [max]="99999" size="sm" class="w-full"
                                                [(ngModel)]="data.Quantity" [ngModelOptions]="{standalone: true}"
                                                [formatter]="numberWithCommas" [parser]="parserComas">
                                            </tds-input-number>
                                        </tds-form-field>
                                    </div>

                                    <div *ngIf="isEditDetails[data.Id]" class="w-full gap-y-1">
                                        <!-- Bật/tắt hoạt động -->
                                        <span class="flex pr-2 w-full truncate">Hoạt động</span>
                                        <tds-checkbox size="sm" [(ngModel)]="data.IsActive" [ngModelOptions]="{standalone: true}"></tds-checkbox>
                                    </div>

                                    <div class="flex gap-x-1 w-full" *ngIf="!isEditDetails[data.Id]">
                                        <span class="flex items-center">Giá:</span>
                                        <div class="text-body-2 text-center flex items-center ml-2 font-semibold">
                                            {{ data.Price || 0 | numberCustom }}đ
                                        </div>
                                    </div>

                                    <div class="flex gap-x-1 w-full desktop:justify-end pr-2.5" *ngIf="!isEditDetails[data.Id]">
                                        <span class="flex items-center">Giới hạn trên đơn:</span>
                                        <div class="text-body-2 text-center flex items-center ml-2 font-semibold">
                                            {{ data.LimitedQuantity || 0 | numberCustom }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </virtual-scroller>
                    <ng-template #noData>
                        <div  class="w-full">
                            <tds-empty></tds-empty>
                        </div>
                    </ng-template>
                </tds-spin>
            </div>
    </tds-tab>

    <tds-tab title="Tổng quan" [clsContent]="'p-0 w-full h-full'">
        <div class="flex flex-col w-full h-[83vh] overflow-auto tds-custom-scroll">
            <div class="flex flex-col flex-auto gap-y-3 bg-neutral-3-50 p-3">
                <div class="flex flex-col bg-white p-4 rounded-xl gap-y-3" *ngIf="dataOverviewReport?.OrderSummary">
                    <span class="text-header-1 font-semibold">Chờ chốt</span>
                    <div class="flex flex-col items-end gap-2 w-full">
                    <div class="flex w-full justify-between items-center gap-x-2">
                        <span class="text-body-2 text-neutral-1-500 text-left">Số lượng đơn</span>
                        <span class="text-header-1 font-semibold text-right">{{ dataOverviewReport.OrderSummary.OrderQuantity || 0 }}</span>
                    </div>

                    <div class="flex w-full justify-between items-center gap-x-2">
                        <span class="text-body-2 text-neutral-1-500 text-left">Số lượng sản phẩm</span>
                        <span class="text-header-1 font-semibold text-right">{{ dataOverviewReport.OrderSummary.ProductQuantity || 0 }}</span>
                    </div>

                    <div class="flex w-full justify-between items-center gap-x-2">
                        <span class="text-body-2 text-neutral-1-500 text-left">Tổng tiền</span>
                        <span class="text-header-1 font-semibold text-right text-info-500">{{ (dataOverviewReport.OrderSummary.TotalAmount || 0) | numberCustom  }}</span>
                    </div>
                    </div>
                </div>

                <div class="flex flex-col bg-white p-4 rounded-xl gap-y-3" *ngIf="dataOverviewReport?.BillSummary">
                    <div class="flex flex-col flex-auto">
                    <span class="text-header-1 font-semibold">Chờ thanh toán</span>
                    <div class="flex flex-col items-end gap-2 w-full pt-3">
                        <div class="flex w-full justify-between items-center gap-x-2">
                        <span class="w- text-body-2 text-neutral-1-500 text-left">Số lượng đơn</span>
                        <span class="text-header-1 font-semibold text-right">{{ dataOverviewReport.BillSummary.OrderQuantity || 0 }}</span>
                        </div>

                        <div class="flex w-full justify-between items-center gap-x-2">
                        <span class="text-body-2 text-neutral-1-500 text-left">Số lượng sản phẩm</span>
                        <span class="text-header-1 font-semibold text-right">{{ dataOverviewReport.BillSummary.ProductQuantity || 0 }}</span>
                        </div>

                        <div class="flex w-full justify-between items-center gap-x-2">
                        <span class="text-body-2 text-neutral-1-500 text-left">Tổng tiền</span>
                        <span class="text-header-1 font-semibold text-right text-info-500">{{ (dataOverviewReport.BillSummary.TotalAmount || 0) | numberCustom  }}</span>
                        </div>
                    </div>
                    </div>
                </div>

                <div class="flex flex-col bg-white p-4 rounded-xl gap-y-3" *ngIf="dataOverviewReport?.PaySummary">
                    <div class="flex flex-col flex-auto">
                    <span class="text-header-1 font-semibold">Thanh toán</span>
                    <div class="flex flex-col items-end gap-2 w-full pt-3">
                        <div class="flex w-full justify-between items-center gap-x-2">
                        <span class="text-body-2 text-neutral-1-500 text-left">Số lượng đơn</span>
                        <span class="text-header-1 font-semibold text-right">{{ dataOverviewReport.PaySummary.OrderQuantity || 0 }}</span>
                        </div>

                        <div class="flex w-full justify-between items-center gap-x-2">
                        <span class="text-body-2 text-neutral-1-500 text-left">Số lượng sản phẩm</span>
                        <span class="text-header-1 font-semibold text-right">{{ dataOverviewReport.PaySummary.ProductQuantity || 0 }}</span>
                        </div>

                        <div class="flex w-full justify-between items-center gap-x-2">
                        <span class="text-body-2 text-neutral-1-500 text-left">Tổng tiền</span>
                        <span class="text-header-1 font-semibold text-right text-info-500">{{ (dataOverviewReport.PaySummary.TotalAmount || 0) | numberCustom  }}</span>
                        </div>
                    </div>
                    </div>
                </div>

                <div class="flex flex-col bg-white p-4 rounded-xl gap-y-3" *ngIf="dataOverviewReport?.BillSummary">
                    <div class="flex flex-col flex-auto">
                    <span class="text-header-1 font-semibold">Tổng hoá đơn</span>
                    <div class="flex flex-col items-end gap-2 w-full pt-3">
                        <div class="flex w-full justify-between items-center gap-x-2">
                        <span class="text-body-2 text-neutral-1-500 text-left">Số lượng đơn</span>
                        <span class="text-header-1 font-semibold text-right">{{  dataOverviewReport.TotalOrderBillSummary?.OrderQuantity | numberCustom }}</span>
                        </div>

                        <div class="flex w-full justify-between items-center gap-x-2">
                        <span class="text-body-2 text-neutral-1-500 text-left">Số lượng sản phẩm</span>
                        <span class="text-header-1 font-semibold text-right">{{ dataOverviewReport.TotalOrderBillSummary?.ProductQuantity | numberCustom }}</span>
                        </div>

                        <div class="flex w-full justify-between items-center gap-x-2">
                        <span class="text-body-2 text-neutral-1-500 text-left">Tổng tiền</span>
                        <span class="text-header-1 font-semibold text-right text-info-500">{{ dataOverviewReport.TotalOrderBillSummary?.TotalAmount | numberCustom }}</span>
                        </div>
                    </div>
                    </div>
                </div>
            </div>
        </div>
    </tds-tab>
</tds-tabset>

<ng-template #contentTemplate>
    <div class="w-[304px]">
        <tds-form-field>
          <tds-label>Áp dụng giới hạn trên đơn cho tất cả sản phẩm</tds-label>
          <tds-input-number [min]="0" [max]="1000000000" [step]="1" [(ngModel)]="limitedQuantityAll"
          [formatter]="numberWithCommas" [parser]="parserComas">
        </tds-input-number>
        </tds-form-field>
    </div>
</ng-template>
<ng-template #footerTemplate>
  <div class="flex justify-end pt-2">
      <button tds-button-icon color="secondary" class="mr-2" size="sm" (click)="onClosePopover()">
      <span class="flex items-center">
          <i class="tdsi-close-fill"></i>
      </span>
      </button>
      <button tds-button-icon size="sm" color="primary" (click)="onSavePopover()">
      <span class="flex items-center">
          <i class="tdsi-tick-fill"></i>
      </span>
      </button>
  </div>
</ng-template>

<!-- Bật tắt sản phẩm -->
<ng-template #contentTemplateIsActive>
  <div class="w-full ml-1 mr-1">
      <p class="text-body-2 mb-2">Hoạt động sản phẩm</p>
      <div class="flex items-center">
        <div class="w-full flex items-center">
            <span class="text-body-2 mr-2">Bật</span>
            <tds-checkbox size="md" [disabled]="isLoading ? true : false" [(ngModel)]="activeProduct" (ngModelChange)="onChangeIsActiveProduct($event, 'active')"></tds-checkbox>
        </div>

        <div class="w-full flex items-center">
            <span class="text-body-2 mr-2">Tắt</span>
            <tds-checkbox size="md" [disabled]="isLoading ? true : false" [(ngModel)]="unactiveProduct" (ngModelChange)="onChangeIsActiveProduct($event, 'unactive')"></tds-checkbox>
        </div>
      </div>
  </div>
</ng-template>
