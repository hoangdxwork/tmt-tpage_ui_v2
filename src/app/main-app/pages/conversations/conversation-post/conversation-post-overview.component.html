<div class="flex flex-col pr-1 py-1 h-full w-full text-body-2 text-neutral-1-900" *ngIf="data">
    <div class="w-full h-full flex flex-col">
        <!-- Tổng quan bài viết-->
        <div class="post-view bg-white flex flex-col w-full mb-1">
            <div class="flex flex-row justify-between p-2 border-b-3 border-neutral-3-200">

                <!-- facebook -->
                <div class="flex items-center gap-x-2" *ngIf="team!.Type == 'Facebook'">

                    <tds-avatar [icon]="(data.Data | facebookType)?.status_type === 'added_video'? 'tdsi-video-camera-fill': 'tdsi-facebook-f-fill'"
                        [ngClass]="(data.Data | facebookType)?.status_type === 'added_video'? 'bg-base-red-500' : 'bg-base-blue-500'" class="text-white"
                        [size]="36" [shape]="'circle'" [isAvatar]="false">
                    </tds-avatar>

                    <tds-tag rounded="rounded-full"
                        [ngClass]="(data.Data | facebookType).status_type === 'added_video' ? '!bg-base-red-50 !text-base-red-600' : '!bg-base-blue-50 !text-base-blue-600'">
                        <span class="flex flex-row items-center py-0.5 gap-x-3 px-1.5">

                            <div class="font-semibold flex flex-col items-center 2xl:block">
                                <span class="hidden desktop:block">{{translateType((data.Data | facebookType).type, (data.Data | facebookType).status_type)}}</span>
                                <span class="whitespace-nowrap">{{(data.Data | facebookType).created_time | date: "dd-MM-yyyy HH:mm"}}</span>
                            </div>

                            <!-- truy cập bài viết -->
                          <div *ngIf="(data.Data | facebookType).permalink_url; else noPermalink_url">
                            <a href="{{(data.Data | facebookType).permalink_url}}" target="_blank" class="text-neutral-1-400">
                                <i class="tdsi-expand-2-line leading-none text-xl"></i>
                            </a>
                          </div>

                          <ng-template #noPermalink_url>
                            <a href="{{linkFacebook + data.ObjectId}}" target="_blank" class="text-neutral-1-400">
                                <i class="tdsi-expand-2-line leading-none text-xl"></i>
                            </a>
                          </ng-template>
                        </span>
                    </tds-tag>

                    <div class="pl-4 flex gap-x-2 items-center" *ngIf="data.LiveCampaignId">
                        <tds-switch size="md" [(ngModel)]="drawerEditLiveCampaign" (ngModelChange)="onChangeDrawerEditLive($event)"
                        [ngModelOptions]="{standalone: true}"></tds-switch>
                    </div>
                </div>

                <!-- tshop -->
                <div class="flex items-center gap-x-3" *ngIf="team!.Type == 'TShop'">
                    <tds-avatar [tdsSrc]="'../../../assets/imagesv2/tshop/_liveapp.svg'"
                        [size]="36" [shape]="'circle'" [isAvatar]="false">
                    </tds-avatar>

                    <tds-tag rounded="rounded-full" class="!bg-base-orange-50 !text-base-orange-500">
                        <span class="flex flex-row items-center py-0.5 gap-x-3 px-1.5">
                            <div class="font-semibold flex flex-col items-center 2xl:block">
                                <span class="whitespace-nowrap">{{ (data.Data | tshopType)?.CreationTime | date: "dd-MM-yyyy HH:mm" }}</span>
                            </div>
                        </span>
                    </tds-tag>

                    <div class="pl-4 flex gap-x-2 items-center" *ngIf="data.LiveCampaignId">
                        <tds-switch size="md" [(ngModel)]="drawerEditLiveCampaign" (ngModelChange)="onChangeDrawerEditLive($event)"
                        [ngModelOptions]="{standalone: true}"></tds-switch>
                    </div>
                </div>

                <!-- tiktok -->
                <div class="flex items-center gap-x-3" *ngIf="team!.Type == 'UnofficialTikTok'">
                    <tds-avatar
                        [tdsSrc]="data.StatusLive ? '../../../assets/imagesv2/tiktok/tiktok-live.svg' : '../../../assets/imagesv2/tiktok/tiktok.svg'"
                        [size]="36" [shape]="'circle'" [isAvatar]="false">
                    </tds-avatar>

                    <tds-tag rounded="rounded-full" class="!bg-neutral-2-100 !text-neutral-1-900">
                        <span class="flex flex-row items-center py-0.5 gap-x-3 px-1.5">
                            <div class="font-semibold flex flex-col items-center 2xl:block">
                                <!-- <span>{{translateType((data.Data | facebookType).type, (data.Data | facebookType).status_type)}}</span> -->
                                <span class="whitespace-nowrap">{{ data.CreatedTime | date: "dd-MM-yyyy HH:mm" }}</span>
                            </div>
                        </span>

                        <!-- truy cập bài live -->
                        <div *ngIf="team?.OwnerId">
                            <a href="https://www.tiktok.com/@{{team.OwnerId}}/live" target="_blank" class="text-neutral-1-400">
                                <i class="tdsi-expand-2-line leading-none text-xl"></i>
                            </a>
                        </div>
                    </tds-tag>

                    <div class="pl-4 flex gap-x-2 items-center" *ngIf="data.LiveCampaignId">
                        <tds-switch size="md" [(ngModel)]="drawerEditLiveCampaign" (ngModelChange)="onChangeDrawerEditLive($event)"
                        [ngModelOptions]="{standalone: true}"></tds-switch>
                    </div>
                </div>

                <div class="post-option flex flex-row items-center gap-2 2xl:gap-3">
                    <button tds-button-outline [color]="defaultProductPost? 'primary': 'secondary'" tds-tooltip tooltipTitle="Sản phẩm mặc định" tooltipPlacement="bottom"
                        (click)="showModalSelectProduct(defaultProductPost)" class="max-w-[152px]">
                        <span class="flex items-center overflow-hidden">
                            <i class="tdsi-product-fill text-lg leading-none desktop:mr-2 laptop:m-0 m-0"></i>
                            <span *ngIf="defaultProductPost; else noDataProduct" class="truncate" class="laptop:hidden desktop:block hidden">
                                {{ defaultProductPost.ProductNameGet }}
                            </span>
                            <ng-template #noDataProduct>
                                <span class="laptop:hidden desktop:block hidden">Chọn sản phẩm</span>
                            </ng-template>
                        </span>
                    </button>

                    <!-- <button tds-button color="secondary" tds-dropdown trigger="click" [tdsDropdownMenu]="menu" tooltipTitle="Thao tác excel" tooltipPlacement="bottom" tds-tooltip>
                        <span class="flex items-center">
                            <i class="tdsi-excel-fill text-2xl leading-none text-neutral-1-600"></i>
                            <i class="tdsi-arrow-down-fill text-lg leading-none ml-2 text-neutral-1-600"></i>
                        </span>
                    </button> -->

                    <tds-dropdown-menu #menu="tdsDropdownMenu">
                        <div class="w-[210px] flex flex-col gap-y-1">
                            <span tds-dropdown-item *ngFor="let item of filterExcel" (click)="onChangeExcel(item)">
                                <a>{{ item.text }}</a>
                            </span>
                        </div>
                    </tds-dropdown-menu>

                    <!-- Cấu hình bài viết -->
                    <button (click)="openConfigPost()" tds-button-icon color="secondary" size="md" tooltipTitle="Cấu hình bài viết" tooltipPlacement="bottom" tds-tooltip>
                        <span class="flex items-center justify-center">
                            <i class="tdsi-gear-2-fill text-neutral-1-500"></i>
                        </span>
                    </button>

                    <!-- cấu hình in -->
                    <!-- <button tds-button-icon color="secondary" size="md" tooltipTitle="Cấu hình in" tooltipPlacement="bottom" tds-tooltip>
                        <span class="flex items-center justify-center">
                            <i class="tdsi-setting-print-fill text-neutral-1-500"></i>
                        </span>
                    </button> -->

                    <!-- đơn hàng -->
                    <!-- <tds-badge [count]="orderTotal || 0" [tdsClass]="'bg-error-400 text-white'" tooltipTitle="Đơn hàng" tooltipPlacement="bottom" tds-tooltip>
                        <button tds-button-icon color="secondary" size="md">
                            <span class="flex items-center justify-center">
                                <i class="tdsi-bag-fill text-neutral-1-500"></i>
                            </span>
                        </button>
                    </tds-badge> -->

                    <!-- reload -->
                    <button tds-button-icon color="secondary" size="md" tooltipTitle="Tải lại trang" tooltipPlacement="bottom" tds-tooltip (click)="fetchComments()">
                        <span class="flex items-center justify-center">
                            <i class="tdsi-reload-fill text-neutral-1-500"></i>
                        </span>
                    </button>
                </div>
            </div>

            <div class="post-block bg-white flex flex-col w-full">

                <!-- Facebook -->
                <div class="post-body flex flex-row justify-between flex-auto desktop:p-4 p-2" *ngIf="team.Type == 'Facebook'">
                    <div class="flex flex-col justify-between gap-y-3 w-3/4">

                        <div class="w-full flex flex-col gap-y-3">
                            <p class="text-title-1 font-semibold" *ngIf="(data.Data | facebookType).story"> {{(data.Data | facebookType).story}} </p>
                            <div showMore [text]="(data.Data | facebookType).message" [length]="400"></div>

                            <p class="description" *ngIf="(data.Data | facebookType).description" showMore [text]="(data.Data | facebookType).description" [length]="400"></p>
                        </div>

                        <div class="flex gap-x-2 items-center">
                            <div *ngIf="data.LiveCampaign">
                                <tds-tag size="sm" class="!bg-base-orange-50 !text-base-orange-500" (click)="showModalLiveCampaign(data, team.Type, data.LiveCampaign.Id)">
                                    <span class="flex items-center py-0.5 cursor-pointer max-w-[150px]" tds-tooltip [tooltipTitle]="data.LiveCampaign.Name">
                                        <span class="flex-auto truncate">{{ data.LiveCampaign.Name }}</span>
                                        <i class="tdsi-arrow-right-line text-lg leading-none ml-1"></i>
                                    </span>
                                </tds-tag>
                            </div>
    
                            <div *ngIf="!data.LiveCampaign">
                                <tds-tag size="sm" tds-popover tds-tooltip="Thêm nhãn chiến dịch"
                                    (click)="openTag(data, team.Type)"
                                    [popoverVisible]="indClickTag == data.Id" popoverTrigger="click"
                                    [popoverAutoClose]="false" [popoverBackdrop]="true"
                                    popoverPlacement="right"
                                    class="!bg-neutral-3-100 !text-neutral-1-600">
                                    <span class="flex items-center py-0.5 cursor-pointer max-w-[150px]">
                                        <span class="flex-auto truncate">Chọn chiến dịch</span>
                                        <i class="tdsi-arrow-right-line text-lg leading-none ml-1"></i>
                                    </span>
                                </tds-tag>
                            </div>
                            <button tds-button-icon color="primary" class="!h-[26px] !w-[26px]" [disabled]="isdisabledAutoOrder" tds-tooltip="Áp dụng ngay cho những bình luận đã có" (click)="onRescanAutoOrder()">
                                <i class="tdsi-flash-on-fill text-body-2 leading-none"></i>
                            </button>
                        </div>
                    </div>
                    <div class="post-picture w-1/4 flex justify-end" *ngIf="(data.Data | facebookType).picture">
                        <img tds-image [fallback]="fallbackImg" [tdsSrc]="(data.Data | facebookType).picture || ''" class="rounded-xl desktop:h-[122px] laptop:h-[100px] object-cover" />
                    </div>
                </div>

                <!-- TShop -->
                <div class="post-body flex flex-row justify-between flex-auto p-4" *ngIf="team.Type == 'TShop'">
                    <div class="flex flex-col justify-between gap-y-3 w-3/4">
                        <div class="w-full flex flex-col gap-y-3">
                            <p class="italic text-neutral-1-900 text-caption-1">
                                {{ (data.Data | tshopType).Content?.Text || '(Chưa có nội dung tiêu đề)' }}
                            </p>
                        </div>

                        <div *ngIf="data.LiveCampaign">
                            <tds-tag size="sm" class="!bg-base-orange-50 !text-base-orange-500" (click)="showModalLiveCampaign(data, team.Type, data.LiveCampaign.Id)">
                                <span class="flex items-center py-0.5 cursor-pointer max-w-[150px]" tds-tooltip [tooltipTitle]="data.LiveCampaign.Name">
                                    <span class="flex-auto truncate">{{ data.LiveCampaign.Name }}</span>
                                    <i class="tdsi-arrow-right-line text-lg leading-none ml-1"></i>
                                </span>
                            </tds-tag>
                        </div>

                        <div *ngIf="!data.LiveCampaign">
                            <tds-tag size="sm" tds-popover tds-tooltip="Thêm nhãn chiến dịch"
                                (click)="openTag(data, team.Type)"
                                [popoverVisible]="indClickTag == data.Id" popoverTrigger="click"
                                [popoverAutoClose]="false" [popoverBackdrop]="true"
                                popoverPlacement="right"
                                class="!bg-neutral-3-100 !text-neutral-1-600">
                                <span class="flex items-center py-0.5 cursor-pointer max-w-[150px]">
                                    <span class="flex-auto truncate">Chọn chiến dịch</span>
                                    <i class="tdsi-arrow-right-line text-lg leading-none ml-1"></i>
                                </span>
                            </tds-tag>
                        </div>
                    </div>

                    <div class="post-picture" *ngIf="(data.Data | tshopType).MediaLive?.ThumbnailUrl">
                        <img tds-image [fallback]="fallbackImg" [tdsSrc]="(data.Data | tshopType).MediaLive?.ThumbnailUrl || ''" class="rounded-xl desktop:h-[122px] laptop:h-[100px] object-cover" />
                    </div>
                </div>
                <!-- tiktok -->
                <div class="post-body flex flex-row justify-between p-4" *ngIf="team.Type == 'UnofficialTikTok'">
                    <div class="flex flex-col justify-between gap-y-3">
                        <div class="w-full flex flex-col gap-y-3">
                            <p class="italic text-neutral-1-900 text-caption-1">
                                {{ data.Description || '(Chưa có nội dung tiêu đề)' }}
                            </p>
                        </div>

                        <div *ngIf="data.LiveCampaign">
                            <tds-tag size="sm" class="!bg-base-orange-50 !text-base-orange-500" (click)="showModalLiveCampaign(data, team.Type, data.LiveCampaign.Id)">
                                <span class="flex items-center py-0.5 cursor-pointer max-w-[150px]" tds-tooltip [tooltipTitle]="data.LiveCampaign.Name">
                                    <span class="flex-auto truncate">{{ data.LiveCampaign.Name }}</span>
                                    <i class="tdsi-arrow-right-line text-lg leading-none ml-1"></i>
                                </span>
                            </tds-tag>
                        </div>

                        <div *ngIf="!data.LiveCampaign">
                            <tds-tag size="sm" tds-popover tds-tooltip="Thêm nhãn chiến dịch"
                                (click)="openTag(data, team.Type)"
                                [popoverVisible]="indClickTag == data.Id" popoverTrigger="click"
                                [popoverAutoClose]="false" [popoverBackdrop]="true"
                                popoverPlacement="right"
                                class="!bg-neutral-3-100 !text-neutral-1-600">
                                <span class="flex items-center py-0.5 cursor-pointer max-w-[150px]">
                                    <span class="flex-auto truncate">Chọn chiến dịch</span>
                                    <i class="tdsi-arrow-right-line text-lg leading-none ml-1"></i>
                                </span>
                            </tds-tag>
                        </div>
                    </div>

                    <div class="post-picture" class="h-[122px]">
                        <img tds-image [fallback]="fallbackImg" [tdsSrc]="data.Thumbnail?.Url || '' " class="rounded-xl desktop:h-[122px] h-[95px] object-cover" />
                    </div>
                </div>

                <div class="post-footer bg-neutral-3-50 text-neutral-1-600 font-regular flex flex-row items-center justify-between py-1 desktop:px-4 laptop:px-2 gap-x-2">
                    <container-element [ngSwitch]="indClickFilter" class="w-full">

                        <!-- lọc tất cả bình luận -->
                        <ng-container *ngSwitchCase="0" class="w-full">
                            <div class="emotion-count flex flex-row items-center flex-auto gap-x-4 justify-between w-full">
                                <div class="flex gap-x-2">
                                    <div class="flex flex-row">
                                        <img src="../../../assets/imagesv2/conversation/like-circle.svg" width="20px" height="20px"
                                            class="rounded-full z-50">
                                        <img src="../../../assets/imagesv2/conversation/love-circle.svg" width="20px" height="20px"
                                            class="rounded-full z-40 -ml-2">
                                    </div>
                                    <span> {{data.CountReaction || 0}} </span>
                                </div>
                                <div class="flex gap-x-3 flex-auto justify-end items-center">
                                    <tds-form-field class="flex-auto">
                                        <span tdsPrefix><i class="tdsi-search-fill"></i></span>
                                        <input tdsInput placeholder="Tìm kiếm bình luận" autocomplete="off" #innerText/>
                                    </tds-form-field>

                                    <div class="flex gap-x-2 text-caption-1 desktop:text-body-2">
                                        <span class="flex-auto"> {{data.CountComment || 0}} bình luận </span>
                                        <span class="flex-auto mr-3"> {{(data.Data | facebookType).count_shares || 0}} lượt chia sẻ </span>
                                    </div>
                                </div>
                            </div>
                        </ng-container>
                    </container-element>

                    <div class="flex flex-row items-center gap-3">
                        <!-- filter -->
                        <div *ngFor="let item of filterOptions; let index = index" (click)="fillterAll(item, index)"
                            [ngClass]="indClickFilter == index ?'bg-primary-3 text-primary-1 border border-primary-1':'border border-transparent'"
                            class="h-[30px] w-[30px] rounded-md cursor-pointer" tds-tooltip [tooltipTitle]="item.text">
                            <span class="flex items-center justify-center">
                                <i class="{{item.icon}} text-xl"></i>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Danh sách bình luận -->
        <div class="flex w-full flex-auto overflow-hidden">
            <tds-spin [spinning]="isLoading" class="flex-auto h-full w-full flex overflow-hidden">
                <div  class="flex w-full h-full overflow-hidden" *ngIf="data && !isLoading">
                    <div *ngIf="currentFilter.value === 'all'" class="h-full w-full">
                        <div *ngIf="team && team.Type == 'Facebook'" class="h-full w-full">
                            <facebook-comment [data]="data" [team]="team" [innerText]="keyWords"></facebook-comment>
                        </div>
                        <div *ngIf="team && team.Type == 'TShop'" class="h-full w-full">
                            <tshop-comment [data]="data" [team]="team" [innerText]="keyWords"></tshop-comment>
                        </div>

                        <div *ngIf="team && team.Type == 'UnofficialTikTok'" class="h-full w-full">
                            <tiktok-comment [data]="data" [team]="team" [innerText]="keyWords"></tiktok-comment>
                        </div>
                    </div>
                </div>
            </tds-spin>
        </div>
    </div>

    <div class="absolute inset-0 pl-1 z-10" [ngStyle]="{ 'width.px': widthConversation }" [ngClass]="visibleDrawerEditLive ? 'block': 'hidden'">
        <tds-spin [spinning]="false" class="h-full w-full flex">
            <tds-drawer [visible]="visibleDrawerEditLive" [width]="widthConversation" [placement]="'left'" [bodyStyle]="{ 'overflow':'hidden', 'display':'flex', 'flex-direction':'column', 'padding':0 }"
                [closeIcon]="closeTmp" [mask]="false" [title]="'Thông tin chiến dịch'">
                <ng-container *tdsDrawerContent>
                    <drawer-edit-livecampaign [visibleDrawerEditLive]="visibleDrawerEditLive" [liveCampaignId]="data.LiveCampaignId"></drawer-edit-livecampaign>
                </ng-container>
            </tds-drawer>
        </tds-spin>
    </div>

    <ng-template #closeTmp>
        <div class="flex items-center justify-end p-2">
            <span class="tdsi-close-fill text-lg leading-none cursor-pointer" (click)="closeDrawerEditLiveCampaign()"></span>
        </div>
    </ng-template>
</div>
