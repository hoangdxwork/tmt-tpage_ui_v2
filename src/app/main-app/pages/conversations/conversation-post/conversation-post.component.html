<div class="w-full h-full flex items-stretch bg-neutral-3-200 overflow-hidden">
    <div class="w-[357px] h-full flex flex-col gap-y-1 text-body-2 text-neutral-1-900 overflow-hidden">
        <div class="w-full flex flex-col gap-1 px-1">
            <div class="bg-white p-2.5 flex flex-col gap-y-4">
                <div class="w-full">
                    <tpage-team-dropdown (tdsClickItem)="onClickTeam($event)"></tpage-team-dropdown>
                </div>
                <div class="flex">
                    <tds-form-field class="w-full mr-2">
                        <input tdsInput placeholder="Tìm kiếm theo họ tên, SĐT" autocomplete="off" #innerText/>
                        <span tdsPrefix><i class="text-neutral-1-500 tdsi-search-fill"></i></span>
                    </tds-form-field>
                    <button tds-flat-button-icon tds-dropdown trigger="click" placement="bottomRight"
                        [tdsDropdownMenu]="btnFilter">
                        <span class="flex items-center text-neutral-1-500 relative">
                            <i class="tdsi-filter-2-line  text-xl leading-5"></i>
                            <div class="overflow-hidden h-3 w-3 bg-primary-1 text-white rounded-full absolute top-0 right-0 flex justify-center items-center"
                                style="transform: translate(30%, -30%); transform-origin: 100% 0px;">
                                <span class="text-[7px] leading-[5px] tdsi-tick-fill ">
                                </span>
                            </div>
                        </span>
                    </button>
                    <!-- droupdown filter -->
                    <tds-dropdown-menu #btnFilter="tdsDropdownMenu">
                        <div class="w-[225px] py-2">
                            <div tds-dropdown-item  *ngFor="let item of lstType"  (click)="setType(item, 'TYPE')">
                              {{item.text}}
                            </div>
                        </div>
                    </tds-dropdown-menu>
                    <button tds-flat-button-icon tds-dropdown trigger="click" placement="bottomRight"
                        [tdsDropdownMenu]="btnUpDown">
                        <span class="flex items-center text-neutral-1-500">
                            <i class="tdsi-sort-up-down-fill text-xl leading-5"></i>
                        </span>
                    </button>
                    <!-- droupdown up down -->
                    <tds-dropdown-menu #btnUpDown="tdsDropdownMenu">
                        <div class="w-[225px] py-2">
                            <div tds-dropdown-item *ngFor="let item of lstTime" (click)="setType(item, 'SORT')">
                              {{item.text}}
                            </div>
                        </div>
                    </tds-dropdown-menu>
                </div>
            </div>
        </div>
        <div class="h-full flex flex-col gap-y-1 overflow-y-auto no-scrollbar p-1">
            <ng-container *ngFor="let item of (data$ | async); let i=index">
                <div *ngIf="item" class="p-2 flex {{ currentPost?.fbid == item.fbid ? 'bg-green-400' : 'bg-white'}}" (click)="selectPost(item)">
                  <div class="mr-2 block">
                    <img tds-image [tdsSrc]="item.picture" alt="{{item.story}}" style="max-width: 120px;max-height: 88px">
                    <div>
                      <!-- phân loại -->
                      <span class="{{getIconTypePost(item.status_type)}}"></span>
                      <!-- lượt comment -->
                      <span class="ml-2">
                          <span class="tdsi-comment-on-fill"></span> {{item.count_comments || 0}}
                      </span>
                      <span *ngIf="compareToday(item.created_time) && item.fbid" class="cursor">
                          <span *ngIf="listBadge[item.fbid] && listBadge[item.fbid].count > 0"> {{listBadge[item.fbid].count}}</span>
                          <span  title="Cập nhật lần cuối lúc: {{item.updated_time | date:'HH:mm dd/MM'}}">
                            {{item.created_time | date:'dd/MM/yyyy HH:mm'}}
                          </span>
                      </span>
                      <span *ngIf="!compareToday(item.created_time) && item.fbid">
                          <span *ngIf="listBadge[item.fbid] && listBadge[item.fbid].count > 0">
                              {{listBadge[item.fbid].count}}
                          </span>
                          <span  title="Cập nhật lần cuối lúc: {{item.updated_time | date:'HH:mm dd/MM'}}">
                            {{item.created_time | date:'dd/MM/yyyy HH:mm'}}
                          </span>
                      </span>
                    </div>
                  </div>
                  <div>
                    <div *ngIf="item.story" class="text-error-500">{{item.story}}</div>
                    <div *ngIf="item.description" class="text-info-500">{{item.description}}</div>
                    <div *ngIf="item.message">{{item.message}}</div>
                    <div *ngIf="!item.story && !item.description && !item.message">
                      (Chưa có tiêu đề)
                    </div>
                  </div>
                </div>
            </ng-container>
        </div>
    </div>
    <!--Chọn bài viết để hiển thị chi tiết-->
    <div class="flex flex-auto flex-col  h-full overflow-hidden">
        <div *ngIf="currentPost && currentTeam">
          <conversation-post-view [data]="currentPost" [team]="currentTeam"></conversation-post-view>
        </div>
        <div *ngIf="!currentPost">
            Hãy chọn một bài viết.
        </div>
    </div>
    <!-- Danh sách khách hàng, đơn hàng -->
    <div class="w-[576px] h-full flex flex-col">
        <tds-tabset class="w-full h-full flex " [clsTab]="'flex-1'"
            [tabBarStyle]="{'padding-right':'0px','padding-left':'0px'}">
            <!-- tab Danh sách -->
            <tds-tab [title]="titleList" clsContent=" -mt-px h-full flex flex-col">
                <ng-template #titleList let-active="active">
                    <div class=" p-4 font-semibold text-body-2 border-b-3 cursor-pointer group flex items-center justify-center"
                        [ngClass]='{"border-primary-1 bg-white":active,"border-transparent text-neutral-1-400 bg-neutral-3-50 hover:border-primary-1":!active}'>
                        <span class="mr-2">Danh sách</span>
                    </div>
                </ng-template>
                <div class="flex pt-1 w-full h-[calc(100vh-109px)]">
                    <div class="w-full h-full flex overflow-hidden flex-col gap-y-4 overflow-y-auto tds-custom-scroll bg-white p-4">
                        <div class="flex gap-x-2">
                            <tds-form-field class="w-full">
                                <input tdsInput placeholder="Tìm kiếm đơn hàng" autocomplete="off" />
                                <span tdsPrefix><i class="text-neutral-1-500 tdsi-search-fill"></i></span>
                            </tds-form-field>
                            <button tds-button color="primary" tds-dropdown trigger="click" [disabled]="true"
                                [tdsDropdownMenu]="manipulation">
                                <span class="flex items-center">
                                    Thao tác <i class="tdsi-arrow-down-fill text-lg leading-none ml-2"></i>
                                </span>
                            </button>
                            <!-- dropdown thao tác -->
                            <tds-dropdown-menu #manipulation="tdsDropdownMenu">
                                <div class="w-full">
                                    <div tds-dropdown-item>
                                        <a> Item 1 </a>
                                    </div>
                                    <div tds-dropdown-item>
                                        <a> Item 2 </a>
                                    </div>
                                    <div tds-dropdown-item>
                                        <a> Item 3 </a>
                                    </div>
                                    <div tds-dropdown-item>
                                        <a> Item 4 </a>
                                    </div>
                                </div>
                            </tds-dropdown-menu>
                        </div>
                        <div class="flex">
                            <tds-filter-status [ngModel]='0' class="flex justify-between">
                                <tds-filter-status-item name='Tất cả' [value]='0' [count]='4'>
                                    <ng-template tds-filter-status-template let-active='active'
                                        let-count='count' let-name='name' let-value>
                                        <div class="py-1 px-2 flex items-center border border-neutral-2-100 border-solid rounded-full mr-2"
                                            [ngClass]="{' border-primary-1':active,'border-neutral-2-100 group-hover:border-primary-1':!active}">
                                            <div class="text-body-2 px-2 font-semibold truncate" [ngClass]="{'text-primary-1':active,'text-neutral-1-400 group-hover:text-primary-1':!active}">
                                                {{name}}&nbsp; {{count}}
                                            </div>
                                        </div>
                                    </ng-template>
                                </tds-filter-status-item>

                                <tds-filter-status-item name='Nháp' [value]='1' [count]='2'>
                                    <ng-template tds-filter-status-template let-active='active'
                                        let-count='count' let-name='name' let-value>
                                        <div class="py-1 px-2 flex items-center border border-neutral-2-100 border-solid rounded-full mr-2"
                                            [ngClass]="{' border-primary-1':active,'border-neutral-2-100 group-hover:border-primary-1':!active}">
                                            <div class="text-body-2 px-2 font-semibold truncate" [ngClass]="{'text-primary-1':active,'text-neutral-1-400 group-hover:text-primary-1':!active}">
                                                {{name}}&nbsp; {{count}}
                                            </div>
                                        </div>
                                    </ng-template>
                                </tds-filter-status-item>

                                <tds-filter-status-item name='Đã xác nhận' [value]='2' [count]='0'>
                                    <ng-template tds-filter-status-template let-active='active'
                                        let-count='count' let-name='name' let-value>
                                        <div class="py-1 px-2 flex items-center border border-neutral-2-100 border-solid rounded-full mr-2"
                                            [ngClass]="{' border-primary-1':active,'border-neutral-2-100 group-hover:border-primary-1':!active}">
                                            <div class="text-body-2 px-2 font-semibold truncate" [ngClass]="{'text-primary-1':active,'text-neutral-1-400 group-hover:text-primary-1':!active}">
                                                {{name}}&nbsp; {{count}}
                                            </div>
                                        </div>
                                    </ng-template>
                                </tds-filter-status-item>

                                <tds-filter-status-item name='Đã thanh toán' [value]='3' [count]='1'>
                                    <ng-template tds-filter-status-template let-active='active'
                                        let-count='count' let-name='name' let-value>
                                        <div class="py-1 px-2 flex items-center border border-neutral-2-100 border-solid rounded-full mr-2"
                                            [ngClass]="{' border-primary-1':active,'border-neutral-2-100 group-hover:border-primary-1':!active}">
                                            <div class="text-body-2 px-2 font-semibold truncate" [ngClass]="{'text-primary-1':active,'text-neutral-1-400 group-hover:text-primary-1':!active}">
                                                {{name}}&nbsp; {{count}}
                                            </div>
                                        </div>
                                    </ng-template>
                                </tds-filter-status-item>

                                <tds-filter-status-item name='Huỷ' [value]='4' [count]='0'>
                                    <ng-template tds-filter-status-template let-active='active'
                                        let-count='count' let-name='name' let-value>
                                        <div class="py-1 px-2 flex items-center border border-neutral-2-100 border-solid rounded-full mr-2"
                                            [ngClass]="{' border-primary-1':active,'border-neutral-2-100 group-hover:border-primary-1':!active}">
                                            <div class="text-body-2 px-2 font-semibold truncate" [ngClass]="{'text-primary-1':active,'text-neutral-1-400 group-hover:text-primary-1':!active}">
                                                {{name}}&nbsp; {{count}}
                                            </div>
                                        </div>
                                    </ng-template>
                                </tds-filter-status-item>

                            </tds-filter-status>
                        </div>
                        <div   class="flex flex-col gap-y-4">
                            <tds-collapse accordion="true">
                                <tds-collapse-panel [header]="headercoll1" [active]="false"
                                    [extra]="extraTpl1">
                                    <div class="w-full">
                                        <tds-table #tableInCollapse
                                            [showPagination]="false">
                                            <thead>
                                                <tr>
                                                    <th>Sản phẩm</th>
                                                    <th>Số lượng</th>
                                                    <th>Thành tiền</th>
                                                    <th>Trạng thái</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <ng-template ngFor let-data [ngForOf]="tableInCollapse.data">
                                                    <tr>
                                                        <td>
                                                            <div class="flex flex-col">
                                                                <span>{{data.name}}</span>
                                                                <span>{{data.price}}</span>
                                                            </div>
                                                        </td>
                                                        <td>{{ data.quantity }}</td>
                                                        <td>{{ data.totalPrice }}</td>
                                                        <td>
                                                            <div class="flex">
                                                                <div class="py-1 px-4 rounded text-white font-semibold"
                                                                [ngClass]="data.status==1?'bg-primary-1':'bg-neutral-1-300 text'">
                                                                    <span>{{data.status==1?'Ưu tiên':'Dự bị'}}</span>
                                                                </div>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                </ng-template>
                                            </tbody>
                                        </tds-table>
                                    </div>
                                </tds-collapse-panel>
                            </tds-collapse>
                            <!-- Header của collapse  -->
                            <ng-template #headercoll1>
                                <div class="flex gap-x-8 items-center z-10">
                                    <div class="flex flex-col">
                                        <div>
                                            <span class="text-info-500 font-semibold">#INV/2022/0236</span>
                                        </div>
                                        <div>
                                            <span class="text-neutral-1-400 text-caption-2">11:00, 25/12/2021 </span>
                                        </div>
                                    </div>
                                    <div class="flex flex-col justify-between">
                                        <div>
                                            <span class="">Đào Xuân Hoàng</span>
                                        </div>
                                        <div class="flex items-center">
                                            <button
                                                class="bg-green-400 rounded h-4 w-4 flex items-center justify-center mr-1">
                                                <span class="flex items-center text-white">
                                                    <i class="tdsi-call-fill text-[10px] leading-[10px]"></i>
                                                </span>
                                            </button>
                                            <button
                                                class="bg-orange-500 rounded h-4 w-4 flex items-center justify-center mr-2">
                                                <span class="flex items-center text-white">
                                                    <i class="tdsi-pin-fill text-[10px] leading-[10px]"></i>
                                                </span>
                                            </button>
                                            <div>
                                                <span class="text-error-400 text-caption-2">Chưa in</span>
                                            </div>
                                        </div>
                                    </div>
                                    <tds-badge status="secondary" text="Nháp"></tds-badge>
                                </div>
                            </ng-template>
                            <ng-template #extraTpl1>
                                <div class="flex gap-x-6 items-center">
                                    <button tds-flat-button-icon>
                                        <span class="flex items-center">
                                            <i class="tdsi-edit-fill"></i>
                                        </span>
                                    </button>
                                    <tds-checkbox></tds-checkbox>
                                </div>
                            </ng-template>
                        </div>
                    </div>
                </div>
            </tds-tab>
            <!-- tab Khách hàng -->
            <tds-tab [title]="titlePartner">
                <ng-template #titlePartner let-active="active">
                    <div class=" p-4 font-semibold text-body-2 border-b-3 cursor-pointer group flex items-center justify-center"
                        [ngClass]='{"border-primary-1 bg-white":active,"border-transparent text-neutral-1-400 bg-neutral-3-50 hover:border-primary-1":!active}'>
                        <span class="mr-2">Khách hàng</span>
                    </div>
                </ng-template>
                <div></div>
            </tds-tab>
            <!-- tab đơn hàng -->
            <tds-tab [title]="titleOrder">
                <ng-template #titleOrder let-active="active">
                    <div class="p-4 font-semibold text-body-2 border-b-3 cursor-pointer group flex items-center justify-center"
                        [ngClass]='{"border-primary-1 bg-white":active,"border-transparent text-neutral-1-400 bg-neutral-3-50 hover:border-primary-1":!active}'>
                        <span class="mr-2">Đơn hàng</span>
                    </div>
                </ng-template>
                <div></div>
            </tds-tab>
        </tds-tabset>
    </div>
</div>
