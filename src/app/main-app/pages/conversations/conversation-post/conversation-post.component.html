<tds-spin [spinning]="isLoading">
    <div class="w-full h-full flex items-stretch bg-neutral-3-200 overflow-hidden text-body-2 text-neutral-1-900">
        <div class="w-[20%] h-full flex flex-col gap-y-1 text-body-2 text-neutral-1-900 overflow-hidden">
            <div class="w-full flex flex-col gap-1 px-1">
                <div class="bg-white p-2.5 flex flex-col gap-y-4">
                    <div class="w-full">
                        <tpage-team-dropdown (tdsClickItem)="onClickTeam($event)"></tpage-team-dropdown>
                    </div>
                    <div class="flex">
                        <tds-form-field class="w-full mr-2">
                            <input tdsInput placeholder="Tìm kiếm theo họ tên, SĐT" autocomplete="off" #innerText />
                            <span tdsPrefix><i class="text-neutral-1-500 tdsi-search-fill"></i></span>
                        </tds-form-field>
                        <button tds-flat-button-icon tds-dropdown trigger="click" placement="bottomRight"
                            [tdsDropdownMenu]="btnFilter">
                            <span class="flex text-neutral-1-500 relative w-[34px] h-[34px]">
                                <i
                                    class="tdsi-filter-2-line text-xl leading-5 h-full w-full flex items-center justify-center"></i>
                                <div class="overflow-hidden h-3 w-3 bg-primary-1 text-white rounded-full absolute top-2 right-2 flex justify-center items-center"
                                    style="transform: translate(30%, -30%); transform-origin: 100% 0px;">
                                    <span class="text-[7px] leading-[5px] tdsi-tick-fill">
                                    </span>
                                </div>
                            </span>
                        </button>
                        <!-- droupdown filter -->
                        <tds-dropdown-menu #btnFilter="tdsDropdownMenu">
                            <div class="w-[225px] py-2">
                                <div tds-dropdown-item *ngFor="let item of lstType" (click)="setType(item, 'TYPE')">
                                    {{item.text}}
                                </div>
                            </div>
                        </tds-dropdown-menu>
                        <button tds-flat-button-icon tds-dropdown trigger="click" placement="bottomRight"
                            [tdsDropdownMenu]="btnUpDown">
                            <span class="flex text-neutral-1-500 w-[24px] h-[24px]">
                                <i
                                    class="tdsi-sort-up-down-fill text-xl leading-5 h-full w-full flex items-center justify-center"></i>
                            </span>
                        </button>
                        <!-- droupdown up down -->
                        <tds-dropdown-menu #btnUpDown="tdsDropdownMenu">
                            <div class="w-[225px] py-2">
                                <div tds-dropdown-item *ngFor="let item of lstTime" (click)="setType(item, 'SORT')">
                                    {{item.text}}
                                </div>
                            </div>
                        </tds-dropdown-menu>
                    </div>
                </div>
            </div>
            <div class="h-full flex flex-col gap-y-1 overflow-y-auto no-scrollbar p-1">
                <ng-container *ngFor="let item of (data$ | async); let i=index">
                    <div *ngIf="item"
                        class="pl-2.5 pr-[14px] py-[14px] flex gap-x-4 {{ currentPost?.fbid == item.fbid ? 'bg-secondary-3 border-l-4 border-blue-500' : 'bg-white border-l-4 border-transparent'}}"
                        (click)="selectPost(item)">
                        <div class="flex flex-col gap-y-3">
                            <div class="relative w-[120px] h-[88px]">
                                <div *ngIf="item.picture; else noPicture">
                                    <img tds-image [tdsSrc]="item.picture" alt=""
                                        class="max-w-[120px] w-[120px] max-h-[88px] h-[88px] rounded-md">
                                </div>
                                <ng-template #noPicture>
                                    <div *ngIf="!item.picture; else errorPicture">
                                        <img tds-image tdsSrc="assets/imagesv2/conversation-post-img.svg" alt=""
                                            class="max-w-[120px] w-[120px] max-h-[88px] h-[88px] rounded-md p-4 bg-neutral-3-50">
                                    </div>
                                    <ng-template #errorPicture>
                                        <img tds-image tdsSrc="assets/imagesv2/errorPic.svg" alt=""
                                            class="max-w-[120px] w-[120px] max-h-[88px] h-[88px] rounded-md p-4 bg-neutral-3-50">
                                    </ng-template>
                                </ng-template>
                                <container-element [ngSwitch]="item.type">
                                    <ng-container *ngSwitchCase="'video_inline'">
                                        <div
                                            class="h-[22px] w-[22px] flex items-center justify-center rounded-full absolute top-2 right-2 border p-1 border-white bg-gradient-to-b from-[#F22727] to-[#FF7575]">
                                            <div class="tdsi-video-camera-fill text-white leading-none"></div>
                                        </div>
                                    </ng-container>
                                    <ng-container *ngSwitchCase="'added_photos'">
                                        <div
                                            class="h-[22px] w-[22px] flex items-center justify-center rounded-full absolute top-2 right-2 border p-1 border-white bg-gradient-to-b from-[#3B7AD9] to-[#6EB3F8]">
                                            <div class="tdsi-images-fill text-white leading-none"></div>
                                        </div>
                                    </ng-container>
                                    <ng-container *ngSwitchDefault>
                                        <div
                                            class="h-[22px] flex items-center justify-center rounded-full absolute top-2 right-2 border p-1 border-white bg-gradient-to-b from-[#F22727] to-[#FF7575]">
                                            <div
                                                class="tdsi-arrow-right-fill text-white leading-2 mr-1 text-caption-2 font-[Lato]">
                                                LIVE</div>
                                        </div>
                                    </ng-container>
                                </container-element>
                            </div>
                            <div class="flex items-center w-full">
                                <div class="flex items-center gap-x-2">
                                    <i class="tdsi-like-line text-neutral-1-500"></i>
                                    <div>{{item.count_reactions || 0}}</div>
                                </div>
                                <div class="ml-4 flex items-center gap-x-2">
                                    <i class="tdsi-message-line text-neutral-1-500"></i>
                                    <div>{{item.count_comments || 0}}</div>
                                </div>
                            </div>
                        </div>
                        <div class="w-full">
                            <div class="w-full" *ngIf="item.description" tds-typography ellipsis [ellipsisRows]="2">
                                {{item.description}}</div>
                            <p *ngIf="!item.description">
                                (Chưa có tiêu đề)
                            </p>
                            <div *ngIf="item.message" class="mt-2 text-neutral-1-400">{{item.message}}</div>
                            <div class="flex justify-between items-center mt-2">
                                <div *ngIf="item.live_campaign">
                                    <tds-tag size="sm"
                                        status="{{ currentPost?.fbid == item.fbid ? 'bg-base-orange-50 text-base-orange-500' : 'bg-neutral-3-100 text-neutral-1-600'}}"
                                        (click)="showModalLiveCampaign(item)">
                                        <span class="flex items-center py-0.5 cursor-pointer" tds-tooltip
                                            [tooltipTitle]="item.live_campaign?.name">
                                            <span
                                                class="truncate max-w-[150px] flex">{{item.live_campaign?.name}}</span>
                                            <i class="tdsi-arrow-right-line text-lg leading-none ml-1"></i>
                                        </span>
                                    </tds-tag>
                                </div>
                                <div *ngIf="!item.live_campaign">
                                    <tds-tag size="sm" status='bg-neutral-3-100 text-neutral-1-600'>
                                        <span class="flex items-center py-0.5 cursor-pointer">
                                            <span class="truncate max-w-[150px] flex">Chọn chiến dịch</span>
                                            <i class="tdsi-arrow-right-line text-lg leading-none ml-1"></i>
                                        </span>
                                    </tds-tag>
                                </div>
                                <div class="flex items-center justify-center">
                                  <div class="w-5 h-5 rounded-full bg-accent-9 flex items-center justify-center">
                                    <i class="tdsi-flash-on-fill text-white leading-5"></i>
                                  </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </ng-container>
            </div>
        </div>
        <!--Chọn bài viết để hiển thị chi tiết-->
        <div class="w-[50%] flex flex-col h-full overflow-hidden">
            <div *ngIf="currentPost && currentTeam" class="h-full w-full">
                <conversation-post-view [data]="currentPost" [team]="currentTeam"></conversation-post-view>
            </div>
            <div *ngIf="!currentPost" class="h-full w-full">
                Hãy chọn một bài viết.
            </div>
        </div>
        <!-- Danh sách khách hàng, đơn hàng -->
        <div class="w-[30%] h-full flex flex-col">
            <tds-tabset class="w-full h-full flex " [clsTab]="'flex-1'" [(selectedIndex)]="currentOrderTab"
                [tabBarStyle]="{'padding-right':'0px','padding-left':'0px'}">
                <!-- tab Danh sách -->
                <tds-tab [title]="titleList" clsContent=" -mt-px h-full flex flex-col">
                    <ng-template #titleList let-active="active">
                        <div class=" p-4 font-semibold text-body-2 border-b-3 cursor-pointer group flex items-center justify-center"
                            [ngClass]='{"border-primary-1 bg-white":active,"border-transparent text-neutral-1-400 bg-neutral-3-50 hover:border-primary-1":!active}'>
                            <span class="mr-2">Danh sách</span>
                        </div>
                    </ng-template>
                    <div class="flex pt-1 w-full h-[calc(100vh-109px)]">
                        <conversation-order-list class="w-full"></conversation-order-list>
                    </div>
                </tds-tab>
                <!-- tab Khách hàng -->
                <tds-tab [title]="titlePartner" clsContent="-mt-px h-full flex flex-col" [disabled]="isDisableTab">
                    <ng-template #titlePartner let-active="active">
                        <div class=" p-4 font-semibold text-body-2 border-b-3 cursor-pointer group flex items-center justify-center"
                            [ngClass]='{"border-primary-1 bg-white":active,"border-transparent text-neutral-1-400 bg-neutral-3-50 hover:border-primary-1":!active}'>
                            <span class="mr-2">Khách hàng</span>
                        </div>
                    </ng-template>
                    <div>
                        <conversation-partner [team]="currentTeam" >
                        </conversation-partner>
                    </div>
                </tds-tab>
                <!-- tab đơn hàng -->
                <tds-tab [title]="titleOrder" clsContent="-mt-px h-full flex flex-col" [disabled]="isDisableTab">
                    <ng-template #titleOrder let-active="active">
                        <div class="p-4 font-semibold text-body-2 border-b-3 cursor-pointer group flex items-center justify-center"
                            [ngClass]='{"border-primary-1 bg-white":active,"border-transparent text-neutral-1-400 bg-neutral-3-50 hover:border-primary-1":!active}'>
                            <span class="mr-2">Đơn hàng</span>
                        </div>
                    </ng-template>
                    <div>
                        <post-order [team]="currentTeam"></post-order>
                    </div>
                </tds-tab>
            </tds-tabset>
        </div>
    </div>
</tds-spin>
