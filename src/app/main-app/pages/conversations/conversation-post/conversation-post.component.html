<tds-spin [spinning]="isLoading">
  <div class="w-full h-full flex items-stretch bg-neutral-3-200 overflow-hidden">
      <div class="w-[20%] h-full flex flex-col gap-y-1 text-body-2 text-neutral-1-900 overflow-hidden">
          <div class="w-full flex flex-col gap-1 px-1">
              <div class="bg-white p-2.5 flex flex-col gap-y-4">
                  <div class="w-full">
                      <tpage-team-dropdown (tdsClickItem)="onClickTeam($event)"></tpage-team-dropdown>
                  </div>
                  <div class="flex">
                      <tds-form-field class="w-full mr-2">
                          <input tdsInput placeholder="Tìm kiếm theo họ tên, SĐT" autocomplete="off" #innerText/>
                          <span tdsPrefix><i class="text-neutral-1-500 tdsi-search-fill"></i></span>
                      </tds-form-field>
                      <button tds-flat-button-icon tds-dropdown trigger="click" placement="bottomRight"
                          [tdsDropdownMenu]="btnFilter">
                          <span class="flex items-center text-neutral-1-500 relative">
                              <i class="tdsi-filter-2-line  text-xl leading-5"></i>
                              <div class="overflow-hidden h-3 w-3 bg-primary-1 text-white rounded-full absolute top-0 right-0 flex justify-center items-center"
                                  style="transform: translate(30%, -30%); transform-origin: 100% 0px;">
                                  <span class="text-[7px] leading-[5px] tdsi-tick-fill ">
                                  </span>
                              </div>
                          </span>
                      </button>
                      <!-- droupdown filter -->
                      <tds-dropdown-menu #btnFilter="tdsDropdownMenu">
                          <div class="w-[225px] py-2">
                              <div tds-dropdown-item  *ngFor="let item of lstType"  (click)="setType(item, 'TYPE')">
                                {{item.text}}
                              </div>
                          </div>
                      </tds-dropdown-menu>
                      <button tds-flat-button-icon tds-dropdown trigger="click" placement="bottomRight"
                          [tdsDropdownMenu]="btnUpDown">
                          <span class="flex items-center text-neutral-1-500">
                              <i class="tdsi-sort-up-down-fill text-xl leading-5"></i>
                          </span>
                      </button>
                      <!-- droupdown up down -->
                      <tds-dropdown-menu #btnUpDown="tdsDropdownMenu">
                          <div class="w-[225px] py-2">
                              <div tds-dropdown-item *ngFor="let item of lstTime" (click)="setType(item, 'SORT')">
                                {{item.text}}
                              </div>
                          </div>
                      </tds-dropdown-menu>
                  </div>
              </div>
          </div>
          <div class="h-full flex flex-col gap-y-1 overflow-y-auto no-scrollbar p-1">
              <ng-container *ngFor="let item of (data$ | async); let i=index">
                  <div *ngIf="item" class="p-2 flex {{ currentPost?.fbid == item.fbid ? 'bg-green-400' : 'bg-white'}}"
                    (click)="selectPost(item)">
                    <div class="mr-2 block">
                      <img tds-image [tdsSrc]="item.picture" alt="{{item.story}}" style="max-width: 120px;max-height: 88px">
                      <div>
                        <!-- phân loại -->
                        <span class="{{getIconTypePost(item.status_type)}} text-neutral-1-500"></span>
                        <!-- lượt comment -->
                        <span class="ml-2">
                          <span class="tdsi-comment-on-fill text-neutral-1-500"></span> {{item.count_comments || 0}}
                        </span>
                        <span *ngIf="compareToday(item.created_time) && item.fbid" class="cursor">
                          <span *ngIf="listBadge[item.fbid] && listBadge[item.fbid].count > 0"> {{listBadge[item.fbid].count}}</span>
                          <span title="Cập nhật lần cuối lúc: {{item.updated_time | date:'HH:mm dd/MM'}}">
                            {{item.created_time | date:'dd/MM/yyyy HH:mm'}}
                          </span>
                        </span>
                        <span *ngIf="!compareToday(item.created_time) && item.fbid">
                          <span *ngIf="listBadge[item.fbid] && listBadge[item.fbid].count > 0">
                            {{listBadge[item.fbid].count}}
                          </span>
                          <span title="Cập nhật lần cuối lúc: {{item.updated_time | date:'HH:mm dd/MM'}}">
                            {{item.created_time | date:'dd/MM/yyyy HH:mm'}}
                          </span>
                        </span>
                      </div>
                    </div>
                    <div>
                      <div *ngIf="item.story" class="text-error-500">{{item.story}}</div>
                      <div *ngIf="item.description" class="text-info-500">{{item.description}}</div>
                      <div *ngIf="item.message">{{item.message}}</div>
                      <p *ngIf="!item.story && !item.description && !item.message">
                        (Chưa có tiêu đề)
                      </p>
                      <div *ngIf="item.live_campaign" class="mt-1">
                        <tds-tag status='warning' type="outline" (click)="showModalLiveCampaign(item)">
                          <span class="flex items-center py-0.5 cursor-pointer" tds-tooltip [tooltipTitle]="item.live_campaign?.name">
                            <span class="truncate max-w-[150px] flex">{{item.live_campaign?.name}}</span>
                            <i class="tdsi-arrow-right-line text-lg leading-none ml-2"></i>
                          </span>
                        </tds-tag>
                      </div>
                    </div>
                  </div>
              </ng-container>
          </div>
      </div>
      <!--Chọn bài viết để hiển thị chi tiết-->
      <div class="w-[50%] flex flex-col h-full overflow-hidden">
          <div *ngIf="currentPost && currentTeam" class="h-full w-full">
            <conversation-post-view [data]="currentPost" [team]="currentTeam"></conversation-post-view>
          </div>
          <div *ngIf="!currentPost" class="h-full w-full">
              Hãy chọn một bài viết.
          </div>
      </div>
      <!-- Danh sách khách hàng, đơn hàng -->
      <div class="w-[30%] h-full flex flex-col">
          <tds-tabset class="w-full h-full flex " [clsTab]="'flex-1'" [(selectedIndex)]="currentOrderTab"
              [tabBarStyle]="{'padding-right':'0px','padding-left':'0px'}">
              <!-- tab Danh sách -->
              <tds-tab [title]="titleList" clsContent=" -mt-px h-full flex flex-col">
                  <ng-template #titleList let-active="active">
                      <div class=" p-4 font-semibold text-body-2 border-b-3 cursor-pointer group flex items-center justify-center"
                          [ngClass]='{"border-primary-1 bg-white":active,"border-transparent text-neutral-1-400 bg-neutral-3-50 hover:border-primary-1":!active}'>
                          <span class="mr-2">Danh sách</span>
                      </div>
                  </ng-template>
                  <div class="flex pt-1 w-full h-[calc(100vh-109px)]">
                    <conversation-order-list class="w-full"></conversation-order-list>
                  </div>
              </tds-tab>
              <!-- tab Khách hàng -->
              <tds-tab [title]="titlePartner" clsContent="-mt-px h-full flex flex-col" [disabled]="isDisableTab">
                  <ng-template #titlePartner let-active="active">
                      <div class=" p-4 font-semibold text-body-2 border-b-3 cursor-pointer group flex items-center justify-center"
                          [ngClass]='{"border-primary-1 bg-white":active,"border-transparent text-neutral-1-400 bg-neutral-3-50 hover:border-primary-1":!active}'>
                          <span class="mr-2">Khách hàng</span>
                      </div>
                  </ng-template>
                  <div>
                    <conversation-partner [team]="currentTeam" (onTabOrder)="onTabOrder($event)"></conversation-partner>
                  </div>
              </tds-tab>
              <!-- tab đơn hàng -->
              <tds-tab [title]="titleOrder"  clsContent="-mt-px h-full flex flex-col" [disabled]="isDisableTab">
                  <ng-template #titleOrder let-active="active">
                      <div class="p-4 font-semibold text-body-2 border-b-3 cursor-pointer group flex items-center justify-center"
                          [ngClass]='{"border-primary-1 bg-white":active,"border-transparent text-neutral-1-400 bg-neutral-3-50 hover:border-primary-1":!active}'>
                          <span class="mr-2">Đơn hàng</span>
                      </div>
                  </ng-template>
                  <div>
                    <post-order [team]="currentTeam"></post-order>
                  </div>
              </tds-tab>
          </tds-tabset>
      </div>
  </div>
</tds-spin>
