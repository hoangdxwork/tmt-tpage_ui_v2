<div *ngIf="item" (click)="selectPost(item)"  class="pl-2.5 pr-[14px] py-[14px] flex gap-x-4
    {{currentPost?.ObjectId == item.ObjectId ? 'bg-secondary-3 border-l-4 border-blue-500' : 'bg-white border-l-4 border-transparent'}}">

    <div class="flex flex-col gap-y-3" *ngIf="item">
        <div class="relative w-[120px] h-[88px]">
            <div *ngIf="(item.Data | facebookType)?.picture; else noPicture" class="relative">
                <img [src]="(item.Data | facebookType)?.picture" alt=""
                    class="max-w-[120px] w-[120px] max-h-[88px] h-[88px] rounded-md object-cover">

                <!-- <span class="absolute inset-0 flex items-center justify-center text-heading-4 text-white font-semibold bg-black bg-opacity-40 rounded-md"
                    *ngIf="item.Data?.count_post_child && item.Data.count_post_child > 0">
                    {{'+' + item.count_post_child}}
                </span> -->
            </div>
            <ng-template #noPicture>
                <div *ngIf="!(item.Data | facebookType)?.picture; else errorPicture">
                    <img src="../../../assets/imagesv2/conversation-post-img.svg" alt=""
                        class="max-w-[120px] w-[120px] max-h-[88px] h-[88px] rounded-md p-4 {{currentPost?.ObjectId == item.ObjectId ?'bg-neutral-3-100' :'bg-neutral-3-50'}}">
                </div>
                <ng-template #errorPicture>
                    <img src="../../../assets/imagesv2/errorPic.svg" alt=""
                        class="max-w-[120px] w-[120px] max-h-[88px] h-[88px] rounded-md p-4 bg-neutral-3-50">
                </ng-template>
            </ng-template>

            <div [ngSwitch]="(item.Data | facebookType)?.status_type">
                <div *ngSwitchCase="'added_video'" class="h-[22px] w-[22px] flex items-center justify-center rounded-full absolute top-2 right-2 p-1 ring-2 ring-white ring-opacity-30 bg-gradient-to-b from-[#F22727] to-[#FF7575]">
                    <div class="tdsi-video-camera-fill text-white leading-none"></div>
                </div>

                <div *ngSwitchCase="'added_photos'" class="h-[22px] w-[22px] flex items-center justify-center rounded-full absolute top-2 right-2 p-1 ring-2 ring-white ring-opacity-30 bg-gradient-to-b from-[#3B7AD9] to-[#6EB3F8]">
                    <div class="tdsi-images-fill text-white leading-none"></div>
                </div>

                <div *ngSwitchCase="'mobile_status_update' || 'published_story' || 'shared_story'" class="h-[22px] w-[22px] flex items-center justify-center rounded-full absolute top-2 right-2 p-1 ring-2 ring-white ring-opacity-30 bg-gradient-to-r from-[#3B7AD9] to-[#6EB3F8]">
                    <div class="tdsi-facebook-f-fill text-white leading-none"></div>
                </div>

                <div *ngSwitchDefault class="h-[22px] flex items-center justify-center rounded-full absolute top-2 right-2 p-1 ring-2 ring-white ring-opacity-30 bg-gradient-to-b from-[#F22727] to-[#FF7575]">
                    <div class="tdsi-arrow-right-fill text-white leading-2 mr-1 text-caption-2 font-[Lato]">LIVE</div>
                </div>
            </div>
        </div>

        <div class="flex items-center w-full">
            <div class="flex items-center gap-x-2 text-neutral-1-400">
                <i class="tdsi-like-line"></i>
                <div>{{(item.Data | facebookType)?.count_reactions || 0}}</div>
            </div>
            <div class="ml-4 flex items-center gap-x-2 text-neutral-1-400">
                <i class="tdsi-message-line"></i>
                <div>{{(item.Data | facebookType)?.count_comments || 0}}</div>
            </div>
        </div>
    </div>
    <div class="flex-auto flex flex-col overflow-hidden gap-y-2">
        <span class="w-full font-semibold truncate" *ngIf="item.Title">{{item.Title}}</span>
        <span *ngIf="!item.Title">(Chưa có tiêu đề)</span>

        <!-- <tds-label *ngIf="mdbFbPost.attachments?.data?.[0]?.title" class="text-info-500">
            {{mdbFbPost.attachments.data.[0].title}}
        </tds-label> -->

        <span *ngIf="(item.Data | facebookType)?.message" class=" text-neutral-1-400">{{(item.Data | facebookType)?.message | slice: 0: 50}}
            <span *ngIf="(item.Data | facebookType)?.message!.length > 50">...</span>
        </span>

        <div class="flex justify-between items-center">
            <span *ngIf="item.ChannelCreatedTime" class="text-neutral-1-400" >
                {{item.ChannelCreatedTime | date:'dd/MM/yyyy'}}
            </span>

            <span *ngIf="item.ChannelUpdatedTime" class="text-neutral-1-400 tdsi-time-line" tds-tooltip tooltipTitle="Cập nhật lần cuối lúc {{item.ChannelUpdatedTime | date:'dd/MM/yyyy HH:mm'}}">
            </span>
        </div>

        <div class="w-full flex justify-between items-center flex-wrap gap-y-2">
            <div *ngIf="item.LiveCampaign">
                <tds-tag size="sm" status="{{ currentPost?.ObjectId == item.ObjectId ? 'bg-base-orange-50 text-base-orange-500' : 'bg-neutral-3-100 text-neutral-1-600'}}"
                    (click)="showModalLiveCampaign(item)">
                    <span class="flex items-center py-0.5 cursor-pointer max-w-[150px]" tds-tooltip
                        [tooltipTitle]="item.LiveCampaign.Name">
                        <span class="flex-auto truncate">{{item.LiveCampaign.Name}}</span>
                        <i class="tdsi-arrow-right-line text-lg leading-none ml-1"></i>
                    </span>
                </tds-tag>
            </div>

            <div *ngIf="!item.LiveCampaign">
                <tds-tag size="sm" tds-popover tds-tooltip="Thêm nhãn chiến dịch"
                    (click)="openTag(item.Id)"
                    [popoverVisible]="indClickTag == item.Id" popoverTrigger="click" [popoverFooter]="footerAddTag"
                    [popoverAutoClose]="false" [popoverContent]="contentAddtag" [popoverBackdrop]="true"
                    popoverPlacement="left"
                    status="{{ currentPost?.ObjectId == item.ObjectId ? 'bg-neutral-3-100 text-neutral-1-600': 'bg-neutral-3-50 text-neutral-1-600'}}">
                    <span class="flex items-center py-0.5 cursor-pointer max-w-[150px]">
                        <span class="flex-auto truncate">Chọn chiến dịch</span>
                        <i class="tdsi-arrow-right-line text-lg leading-none ml-1"></i>
                    </span>
                </tds-tag>

                <ng-template #contentAddtag>
                    <div class="w-[304px]">
                        <tds-form-field>
                            <tds-select valueField="Id" textField="Name" placeholder='Chọn chiến dịch'
                                [(ngModel)]="currentLiveCampaign" [data]="lstOfLiveCampaign"
                                [allowClear]="true" [valuePrimitive]="false" [autoClose]="false">
                            </tds-select>
                        </tds-form-field>
                    </div>
                  </ng-template>

                  <ng-template #footerAddTag>
                    <div class="flex justify-end pt-2">
                        <button tds-button-icon type="button" color="secondary" class="mr-2" size="sm" (click)="closeTag()">
                            <span class="flex items-center">
                              <i class="tdsi-close-fill"></i>
                            </span>
                        </button>

                        <button tds-button-icon type="button" size="sm" color="primary" (click)="updateFacebookByLiveCampaign()">
                            <span class="flex items-center">
                              <i class="tdsi-tick-fill"></i>
                            </span>
                        </button>
                    </div>
                </ng-template>
            </div>

            <div *ngIf="item.LiveCampaign" class="flex">
                <div class="w-5 h-5 rounded-full bg-accent-9 flex items-center justify-center"
                    tds-tooltip tooltipTitle="Bật tạo đơn tự động">
                    <i class="tdsi-flash-on-fill text-white leading-5"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<div *ngIf="postChilds && postChilds.length > 0" class="pl-7 flex flex-col gap-y-1">
    <div *ngFor="let postChild of postChilds">
        <ng-container *ngIf="postChild.parent_id && postChild.parent_id == item!.ObjectId">
            <div class="pl-2.5 pr-[14px] py-[14px] flex gap-x-4 {{ currentPost?.ObjectId == postChild.fbid ? 'bg-secondary-3 border-l-4 border-blue-500' : 'bg-white border-l-4 border-transparent'}}"
                (click)="selectPost(postChild)">

                <div class="flex flex-col gap-y-3">
                    <div class="relative w-[120px] h-[88px]">
                        <div *ngIf="postChild.picture; else noPicture" class="relative">
                            <img [src]="postChild.picture" alt=""
                                class="max-w-[120px] w-[120px] max-h-[88px] h-[88px] rounded-md">
                        </div>
                        <ng-template #noPicture>
                            <div *ngIf="!postChild.picture; else errorPicture">
                                <img src="assets/imagesv2/conversation-post-img.svg" alt=""
                                    class="max-w-[120px] w-[120px] max-h-[88px] h-[88px] rounded-md p-4 {{currentPost?.ObjectId == postChild.fbid ?'bg-neutral-3-100' :'bg-neutral-3-50'}}">
                            </div>
                            <ng-template #errorPicture>
                                <img src="assets/imagesv2/errorPic.svg" alt=""
                                    class="max-w-[120px] w-[120px] max-h-[88px] h-[88px] rounded-md p-4 bg-neutral-3-50">
                            </ng-template>
                        </ng-template>
                    </div>

                    <div class="flex items-center w-full">
                        <div class="flex items-center gap-x-2 text-neutral-1-400">
                            <i class="tdsi-like-line"></i>
                            <div>{{postChild.count_reactions || 0}}</div>
                        </div>
                        <div class="ml-4 flex items-center gap-x-2 text-neutral-1-400">
                            <i class="tdsi-message-line"></i>
                            <div>{{postChild.count_comments || 0}}</div>
                        </div>
                    </div>
                </div>
                <div class="flex-auto flex flex-col overflow-hidden gap-y-2">
                    <span class="w-full font-semibold truncate" *ngIf="postChild.description">
                        {{postChild.description}}
                    </span>

                    <span *ngIf="!postChild.description">
                        (Chưa có mô tả)
                    </span>

                    <span *ngIf="postChild.message" class=" text-neutral-1-400">{{postChild.message | slice: 0: 50}}
                        <span *ngIf="postChild.message.length > 50">...</span>
                    </span>

                    <span *ngIf="postChild.created_time | compareToday" class="text-neutral-1-400">
                        {{postChild.created_time | yiDateTimeFormat}}
                    </span>

                    <span *ngIf="!(postChild.created_time | compareToday)"
                        class="text-neutral-1-400">
                        {{postChild.created_time | date:'dd/MM/yyyy HH:mm'}}
                    </span>

                    <div class="w-full flex justify-between items-center">
                        <div *ngIf="postChild.live_campaign">
                            <tds-tag size="sm"
                                status="{{ currentPost?.ObjectId == postChild.fbid ? 'bg-base-orange-50 text-base-orange-500' : 'bg-neutral-3-100 text-neutral-1-600'}}"
                                (click)="showModalLiveCampaign(postChild)">
                                <span class="flex items-center py-0.5 cursor-pointer max-w-[150px]"
                                    tds-tooltip [tooltipTitle]="postChild.live_campaign?.name">
                                    <span
                                        class="flex-auto truncate">{{postChild.live_campaign?.name}}</span>
                                    <i class="tdsi-arrow-right-line text-lg leading-none ml-1"></i>
                                </span>
                            </tds-tag>
                        </div>

                        <div *ngIf="!postChild.live_campaign">
                            <tds-tag size="sm"
                                status="{{ currentPost?.ObjectId == postChild.fbid ? 'bg-neutral-3-100 text-neutral-1-600': 'bg-neutral-3-50 text-neutral-1-600'}}">
                                <span class="flex items-center py-0.5 cursor-pointer max-w-[150px]">
                                    <span class="flex-auto truncate">Chọn chiến dịch</span>
                                    <i class="tdsi-arrow-right-line text-lg leading-none ml-1"></i>
                                </span>
                            </tds-tag>
                        </div>

                        <div *ngIf="postChild.live_campaign"
                            class="flex items-center justify-center">
                            <div class="w-5 h-5 rounded-full bg-accent-9 flex items-center justify-center"
                                tds-tooltip tooltipTitle="Bật tạo đơn tự động">
                                <i class="tdsi-flash-on-fill text-white leading-5"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </ng-container>
    </div>
</div>
