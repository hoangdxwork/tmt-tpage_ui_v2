<div class="flex flex-col ">
    <div *ngIf="item" (click)="selectPost(item)"  class="pl-2.5 desktop:pr-[14px] desktop:py-[14px] py-2 pr-2 flex desktop:gap-x-4 gap-x-2
    {{currentPost?.ObjectId == item.ObjectId ? 'bg-secondary-3 border-l-4 border-blue-500' : 'bg-white border-l-4 border-transparent'}}">

    <div class="flex flex-col gap-y-3" *ngIf="(item.Data | facebookType)">
        <div class="relative desktop:w-[120px] desktop:h-[88px] w-[105px] h-[72px]">
            <div *ngIf="((item.Data | facebookType)?.picture || (item.Data | facebookType)?.full_picture || item.Thumbnail?.Url) && !checkPostPictureError(item); else noPicture" class="relative">
                <img [src]="(item.Data | facebookType)?.picture || (item.Data | facebookType)?.full_picture || item.Thumbnail?.Url" alt="" (error)="errorPostPicture(item)"
                    class="desktop:max-w-[120px] desktop:w-[120px] desktop:max-h-[88px] desktop:h-[88px] max-w-[105px] max-h-[72px] w-[105px] h-[72px] rounded-md object-cover">

                <span class="absolute inset-0 flex items-center justify-center text-heading-4 text-white font-semibold bg-black bg-opacity-40 rounded-md"
                    *ngIf="extrasChilds && extrasChilds.length > 0">
                    {{'+' + extrasChilds.length}}
                </span>
            </div>
            <ng-template #noPicture>
                <div *ngIf="!((item.Data | facebookType)?.picture || (item.Data | facebookType)?.full_picture || item.Thumbnail?.Url); else errorPicture" class="relative">
                    <img src="../../../assets/imagesv2/conversation-post-img.svg" alt=""
                        class="desktop:max-w-[120px] desktop:w-[120px] desktop:max-h-[88px] desktop:h-[88px] max-w-[105px] max-h-[72px] w-[105px] h-[72px] rounded-md p-4 {{currentPost?.ObjectId == item.ObjectId ?'bg-neutral-3-100' :'bg-neutral-3-50'}}">
                </div>
                <ng-template #errorPicture>
                    <img src="../../../assets/imagesv2/errorPic.svg" alt=""  class="relative"
                        class="desktop:max-w-[120px] desktop:w-[120px] desktop:max-h-[88px] desktop:h-[88px] max-w-[105px] max-h-[72px] w-[105px] h-[72px] rounded-md p-4 {{currentPost?.ObjectId == item.ObjectId ?'bg-neutral-3-100' :'bg-neutral-3-50'}}">

                    <span class="absolute inset-0 flex items-center justify-center text-heading-4 text-white font-semibold bg-black bg-opacity-40 rounded-md"
                        *ngIf="extrasChilds && extrasChilds.length > 0">
                        {{'+' + extrasChilds.length}}
                    </span>
                </ng-template>
            </ng-template>

            <div [ngSwitch]="(item.Data | facebookType)?.status_type">
                <div *ngSwitchCase="'added_video'" class="h-[22px] w-[22px] flex items-center justify-center rounded-full absolute top-2 right-2 p-1 ring-2 ring-white ring-opacity-30 bg-gradient-to-b from-[#F22727] to-[#FF7575]">
                    <div class="tdsi-video-camera-fill text-white leading-none"></div>
                </div>

                <div *ngSwitchCase="'added_photos'" class="h-[22px] w-[22px] flex items-center justify-center rounded-full absolute top-2 right-2 p-1 ring-2 ring-white ring-opacity-30 bg-gradient-to-b from-[#3B7AD9] to-[#6EB3F8]">
                    <div class="tdsi-images-fill text-white leading-none"></div>
                </div>

                <div *ngSwitchCase="'mobile_status_update' || 'published_story' || 'shared_story'" class="h-[22px] w-[22px] flex items-center justify-center rounded-full absolute top-2 right-2 p-1 ring-2 ring-white ring-opacity-30 bg-gradient-to-r from-[#3B7AD9] to-[#6EB3F8]">
                    <div class="tdsi-facebook-f-fill text-white leading-none"></div>
                </div>

                <div *ngSwitchDefault class="h-[22px] flex items-center justify-center rounded-full absolute top-2 right-2 p-1 ring-2 ring-white ring-opacity-30 bg-gradient-to-b from-[#F22727] to-[#FF7575]">
                    <div class="tdsi-arrow-right-fill text-white leading-2 mr-1 text-caption-2 font-[Lato]">LIVE</div>
                </div>
            </div>
        </div>

        <div class="flex items-center w-full">
            <div class="flex items-center gap-x-2 text-neutral-1-400">
                <i class="tdsi-like-line"></i>
                <div>{{item.CountReaction || 0}}</div>
            </div>
            <div class="ml-4 flex items-center gap-x-2 text-neutral-1-400">
                <i class="tdsi-message-line"></i>
                <div>{{item.CountComment || 0}}</div>
            </div>
        </div>
    </div>
    <div class="flex-auto flex flex-col overflow-hidden gap-y-2">
        <span class="w-full font-semibold truncate" *ngIf="item.Title || (item.Data | facebookType)?.attachments && (item.Data | facebookType)?.attachments!.data
        && (item.Data | facebookType)?.attachments!.data[0].title; else noTitle">
            {{item.Title || (item.Data | facebookType)?.attachments!.data[0].title}}
        </span>
        <ng-template #noTitle>
            <span *ngIf="!item.Title">(Chưa có tiêu đề)</span>
        </ng-template>

        <span *ngIf="(item.Data | facebookType)?.message" class=" text-neutral-1-400 line-clamp">
            {{(item.Data | facebookType)?.message}}
        </span>

        <div class="flex gap-x-2 items-center">
            <span *ngIf="item.ChannelCreatedTime" class="text-neutral-1-400 hidden desktop:block" >
                {{item.ChannelCreatedTime | date:'dd/MM/yyyy HH:mm'}}
            </span>

            <span *ngIf="item.ChannelUpdatedTime" class="text-neutral-1-400 tdsi-time-line" tds-tooltip tooltipTitle="Cập nhật lần cuối lúc {{item.ChannelUpdatedTime | date:'dd/MM/yyyy HH:mm'}}">
            </span>
        </div>

        <div class="w-full flex justify-between items-center flex-wrap gap-y-2">
            <div *ngIf="item.LiveCampaign" class="item-object-live">
                <tds-tag size="sm" class="!bg-base-orange-50 !text-base-orange-500"
                    (click)="showModalLiveCampaign(item)">
                    <span class="flex items-center py-0.5 cursor-pointer max-w-[150px]" tds-tooltip
                        [tooltipTitle]="item.LiveCampaign.Name">
                        <span class="flex-auto truncate">{{item.LiveCampaign.Name}}</span>
                        <i class="tdsi-arrow-right-line text-lg leading-none ml-1"></i>
                    </span>
                </tds-tag>
            </div>

            <div *ngIf="!item.LiveCampaign" class="item-object-live">
                <tds-tag size="sm" tds-popover tds-tooltip="Thêm nhãn chiến dịch"
                    (click)="openTag(item)"
                    [popoverVisible]="indClickTag == item.Id" popoverTrigger="click"
                    [popoverAutoClose]="false" [popoverBackdrop]="true"
                    popoverPlacement="left" [popoverAutoClose]="false"
                    class="{{ currentPost?.ObjectId == item.ObjectId ? '!bg-neutral-3-100 !text-neutral-1-600': '!bg-neutral-3-50 !text-neutral-1-600'}}">
                    <span class="flex items-center py-0.5 cursor-pointer max-w-[150px]">
                        <span class="flex-auto truncate">Chọn chiến dịch</span>
                        <i class="tdsi-arrow-right-line text-lg leading-none ml-1"></i>
                    </span>
                </tds-tag>
            </div>
        </div>
    </div>
</div>

<div *ngIf="item && extrasChilds && extrasChilds.length > 0 && clickCurrentChild && clickCurrentChild == item.ObjectId" class="pl-7 flex flex-col tds-panel-scroll"  style="max-height: 460px; overflow-y: auto;" >
    <div *ngFor="let child  of extrasChilds">
        <ng-container *ngIf="child.Data?.parent_id && child.Data?.parent_id == item!.ObjectId">
            <div class="pl-2.5 pr-[14px] py-[14px] flex gap-x-4 mt-1 {{ currentPost?.ObjectId == child.ObjectId ? 'bg-secondary-3 border-l-4 border-blue-500' : 'bg-white border-l-4 border-transparent'}}"
                (click)="selectPost(child)">

                <div class="flex flex-col gap-y-3">
                    <div class="relative desktop:w-[120px] desktop:h-[88px] w-[105px] h-[72px]">
                        <div *ngIf="child.Data?.picture && !checkPostPictureError(child); else noPicture" class="relative">
                            <img [src]="child.Data?.picture" alt="" (error)="errorPostPicture(child)"
                                class="desktop:max-w-[120px] desktop:w-[120px] desktop:max-h-[88px] desktop:h-[88px] max-w-[105px] max-h-[72px] w-[105px] h-[72px] rounded-md object-cover">
                        </div>
                        <ng-template #noPicture>
                            <div *ngIf="!child.Data?.picture; else errorPicture">
                                <img src="assets/imagesv2/conversation-post-img.svg" alt=""
                                    class="desktop:max-w-[120px] desktop:w-[120px] desktop:max-h-[88px] desktop:h-[88px] max-w-[105px] max-h-[72px] w-[105px] h-[72px] rounded-md p-4 {{currentPost?.ObjectId == child.ObjectId ?'bg-neutral-3-100' :'bg-neutral-3-50'}}">
                            </div>
                            <ng-template #errorPicture>
                                <img src="assets/imagesv2/errorPic.svg" alt=""
                                    class="desktop:max-w-[120px] desktop:w-[120px] desktop:max-h-[88px] desktop:h-[88px] max-w-[105px] max-h-[72px] w-[105px] h-[72px] rounded-md p-4 {{currentPost?.ObjectId == child.ObjectId ?'bg-neutral-3-100' :'bg-neutral-3-50'}}">
                            </ng-template>
                        </ng-template>
                    </div>

                    <div class="flex items-center w-full">
                        <div class="flex items-center gap-x-2 text-neutral-1-400">
                            <i class="tdsi-like-line"></i>
                            <div>{{child.CountReaction || 0}}</div>
                        </div>
                        <div class="ml-4 flex items-center gap-x-2 text-neutral-1-400">
                            <i class="tdsi-message-line"></i>
                            <div>{{child.CountComment || 0}}</div>
                        </div>
                    </div>
                </div>
                <div class="flex-auto flex flex-col overflow-hidden gap-y-2">
                    <span class="w-full font-semibold truncate" *ngIf="child.description">
                        {{child.description}}
                    </span>

                    <span *ngIf="child.Data && child.Data.message; else noMessChild" class="font-semibold line-clamp">
                        {{child.Data.message}}
                    </span>
                    <ng-template #noMessChild>
                        <span>(Chưa có mô tả)</span>
                    </ng-template>

                    <span *ngIf="child.ChannelCreatedTime" class="text-neutral-1-400 flex gap-x-2 items-center">
                        {{child.ChannelCreatedTime | date:'dd/MM/yyyy HH:mm'}}

                        <span *ngIf="item.ChannelUpdatedTime" class="text-neutral-1-400 tdsi-time-line" tds-tooltip tooltipTitle="Cập nhật lần cuối lúc {{child.ChannelUpdatedTime | date:'dd/MM/yyyy HH:mm'}}">
                        </span>
                    </span>

                    <span *ngIf="!(child.created_time | date:'dd/MM/yyyy HH:mm')"
                        class="text-neutral-1-400">
                        {{child.created_time | date:'dd/MM/yyyy HH:mm'}}
                    </span>

                    <!-- <div class="w-full flex justify-between items-center">
                        <div *ngIf="postChild.live_campaign">
                            <tds-tag size="sm" (click)="showModalLiveCampaign(postChild)" class="!bg-base-orange-50 !text-base-orange-500"
                                status="{{ currentPost?.ObjectId == postChild.fbid ? 'bg-base-orange-50 text-base-orange-500' : 'bg-neutral-3-100 text-neutral-1-600'}}" >
                                <span class="flex items-center py-0.5 cursor-pointer max-w-[150px]"
                                    tds-tooltip [tooltipTitle]="postChild.live_campaign?.name">
                                    <span
                                        class="flex-auto truncate">{{postChild.live_campaign?.name}}</span>
                                    <i class="tdsi-arrow-right-line text-lg leading-none ml-1"></i>
                                </span>
                            </tds-tag>
                        </div>

                        <div *ngIf="!postChild.live_campaign">
                            <tds-tag size="sm" class="{{ currentPost?.ObjectId == postChild.ObjectId ? '!bg-neutral-3-100 !text-neutral-1-600': '!bg-neutral-3-50 !text-neutral-1-600'}}">
                                <span class="flex items-center py-0.5 cursor-pointer max-w-[150px]">
                                    <span class="flex-auto truncate">Chọn chiến dịch</span>
                                    <i class="tdsi-arrow-right-line text-lg leading-none ml-1"></i>
                                </span>
                            </tds-tag>
                        </div>

                        <div *ngIf="postChild.live_campaign"
                            class="flex items-center justify-center">
                            <div class="w-5 h-5 rounded-full bg-accent-9 flex items-center justify-center"
                                tds-tooltip tooltipTitle="Bật tạo đơn tự động">
                                <i class="tdsi-flash-on-fill text-white leading-5"></i>
                            </div>
                        </div>
                    </div> -->
                </div>
            </div>
        </ng-container>
    </div>
</div>
</div>

