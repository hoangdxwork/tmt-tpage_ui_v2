<div class="flex flex-col relative pr-1 py-1 h-full w-full text-body-2 text-neutral-1-900" *ngIf="data">
    <div class="w-full h-full flex flex-col">
        <!-- Tổng quan bài viết-->
        <div class="post-view bg-white flex flex-col w-full mb-1">
            <div class="flex flex-row justify-between p-2 border-b-3 border-neutral-3-200">

                <!-- facebook -->
                <div class="flex items-center" *ngIf="team!.Type == 'Facebook'">

                    <tds-avatar [icon]="(data.Data | facebookType)?.status_type === 'added_video'? 'tdsi-video-camera-fill': 'tdsi-facebook-f-fill'"
                        [ngClass]="(data.Data | facebookType)?.status_type === 'added_video'? 'bg-base-red-500' : 'bg-base-blue-500'" class="text-white mr-1"
                        [size]="36" [shape]="'circle'" [isAvatar]="false">
                    </tds-avatar>

                    <tds-tag rounded="rounded-full"
                        [status]="(data.Data | facebookType).status_type === 'added_video' ? 'bg-base-red-50 text-base-red-600' : 'bg-base-blue-50 text-base-blue-600'">
                        <span class="flex flex-row items-center py-0.5 gap-x-3 px-1.5">

                            <div class="font-semibold flex flex-col items-center 2xl:block">
                                <span>{{translateType((data.Data | facebookType).type, (data.Data | facebookType).status_type)}}</span>
                                <span class="whitespace-nowrap">{{(data.Data | facebookType).created_time | date: "dd-MM-yyyy HH:mm"}}</span>
                            </div>

                            <!-- truy cập bài viết -->
                            <a href="{{(data.Data | facebookType).permalink_url}}" target="_blank" class="text-neutral-1-400">
                                <i class="tdsi-expand-2-line leading-none text-xl"></i>
                            </a>
                        </span>
                    </tds-tag>
                </div>

                <!-- tshop -->
                <div class="flex items-center" *ngIf="team!.Type == 'TShop'">
                    <tds-avatar [icon]="(data.Data | tshopType)?.KindValue == 1 ? 'tdsi-video-camera-fill': 'tdsi-facebook-f-fill'"
                        [ngClass]="(data.Data | tshopType)?.KindValue == 1 ? 'bg-base-red-500' : 'bg-base-blue-500'" class="text-white mr-1"
                        [size]="36" [shape]="'circle'" [isAvatar]="false">
                    </tds-avatar>

                    <tds-tag rounded="rounded-full" [status]="(data.Data | tshopType)?.KindValue == 1 ? 'bg-base-red-50 text-base-red-600' : 'bg-base-blue-50 text-base-blue-600'">
                        <span class="flex flex-row items-center py-0.5 gap-x-3 px-1.5">
                            <div class="font-semibold flex flex-col items-center 2xl:block">
                                <!-- <span>{{translateType((data.Data | facebookType).type, (data.Data | facebookType).status_type)}}</span> -->
                                <span class="whitespace-nowrap">{{(data.Data | tshopType)?.CreationTime | date: "dd-MM-yyyy HH:mm"}}</span>
                            </div>
                            <!-- truy cập bài viết -->
                            <a [href]="(data.Data | tshopType)?.MediaLive?.RecordUrl" target="_blank" class="text-neutral-1-400">
                                <i class="tdsi-expand-2-line leading-none text-xl"></i>
                            </a>
                        </span>
                    </tds-tag>
                </div>


                <div class="post-option flex flex-row items-center gap-2 2xl:gap-3">
                    <button tds-button-outline [color]="defaultProductPost? 'primary': 'secondary'" tds-tooltip tooltipTitle="Sản phẩm mặc định" tooltipPlacement="bottom"
                        (click)="showModalSelectProduct(defaultProductPost)" class="max-w-[152px]">
                        <span class="flex items-center overflow-hidden">
                            <i class="tdsi-product-fill text-lg leading-none mr-2"></i>
                            <span *ngIf="defaultProductPost; else noDataProduct" class="truncate">
                                {{defaultProductPost.ProductNameGet}}
                            </span>
                            <ng-template #noDataProduct>
                                <span>Chọn sản phẩm</span>
                            </ng-template>
                        </span>
                    </button>

                    <button tds-button color="secondary" tds-dropdown trigger="click" [tdsDropdownMenu]="menu" tooltipTitle="Thao tác excel" tooltipPlacement="bottom" tds-tooltip>
                        <span class="flex items-center">
                            <i class="tdsi-excel-fill text-2xl leading-none text-neutral-1-600"></i>
                            <i class="tdsi-arrow-down-fill text-lg leading-none ml-2 text-neutral-1-600"></i>
                        </span>
                    </button>

                    <tds-dropdown-menu #menu="tdsDropdownMenu">
                        <div class="w-[200px] flex flex-col gap-y-1">
                            <span tds-dropdown-item *ngFor="let item of filterExcel" (click)="onChangeExcel(item)">
                                <a>{{item.text}}</a>
                            </span>
                        </div>
                    </tds-dropdown-menu>

                    <!-- cài đặt-->
                    <button (click)="openConfigPost()" tds-button-icon color="secondary" size="md" tooltipTitle="Cấu hình bài viết" tooltipPlacement="bottom" tds-tooltip>
                        <span class="flex items-center justify-center">
                            <i class="tdsi-gear-2-fill text-neutral-1-500"></i>
                        </span>
                    </button>

                    <!-- cấu hình bài viết -->
                    <!-- <button tds-button-icon color="secondary" size="md" tooltipTitle="Cấu hình in" tooltipPlacement="bottom" tds-tooltip>
                        <span class="flex items-center justify-center">
                            <i class="tdsi-setting-print-fill text-neutral-1-500"></i>
                        </span>
                    </button> -->

                    <!-- đơn hàng -->
                    <!-- <tds-badge [count]="orderTotal || 0" [tdsClass]="'bg-error-400 text-white'" tooltipTitle="Đơn hàng" tooltipPlacement="bottom" tds-tooltip>
                        <button tds-button-icon color="secondary" size="md">
                            <span class="flex items-center justify-center">
                                <i class="tdsi-bag-fill text-neutral-1-500"></i>
                            </span>
                        </button>
                    </tds-badge> -->

                    <!-- reload -->
                    <button tds-button-icon color="secondary" size="md" tooltipTitle="Tải lại trang" tooltipPlacement="bottom" tds-tooltip (click)="fetchComments()">
                        <span class="flex items-center justify-center">
                            <i class="tdsi-reload-fill text-neutral-1-500"></i>
                        </span>
                    </button>
                </div>
            </div>

            <div class="post-block bg-white flex flex-col w-full">

                <!-- Facebook -->
                <div class="post-body flex flex-row justify-between flex-auto p-4" *ngIf="team.Type == 'Facebook'">
                    <div class="flex flex-col justify-between gap-y-3 w-3/4">

                        <div class="w-full flex flex-col gap-y-3">
                            <p class="text-title-1 font-semibold" *ngIf="(data.Data | facebookType).story"> {{(data.Data | facebookType).story}} </p>
                            <div showMore [text]="(data.Data | facebookType).message" [length]="400"></div>

                            <p class="description" *ngIf="(data.Data | facebookType).description" showMore [text]="(data.Data | facebookType).description" [length]="400"></p>
                        </div>

                        <div *ngIf="data.LiveCampaign">
                            <tds-tag size="sm" status="bg-base-orange-50 text-base-orange-500" (click)="showModalLiveCampaign(data)">
                                <span class="flex items-center py-0.5 cursor-pointer max-w-[150px]" tds-tooltip [tooltipTitle]="data.LiveCampaign.Name">
                                    <span class="flex-auto truncate">{{ data.LiveCampaign.Name }}</span>
                                    <i class="tdsi-arrow-right-line text-lg leading-none ml-1"></i>
                                </span>
                            </tds-tag>
                        </div>

                        <div *ngIf="!data.LiveCampaign">
                            <tds-tag size="sm" tds-popover tds-tooltip="Thêm nhãn chiến dịch"
                                (click)="openTag(data)"
                                [popoverVisible]="indClickTag == data.Id" popoverTrigger="click"
                                [popoverAutoClose]="false" [popoverBackdrop]="true"
                                popoverPlacement="right"
                                status="bg-neutral-3-100 text-neutral-1-600">
                                <span class="flex items-center py-0.5 cursor-pointer max-w-[150px]">
                                    <span class="flex-auto truncate">Chọn chiến dịch</span>
                                    <i class="tdsi-arrow-right-line text-lg leading-none ml-1"></i>
                                </span>
                            </tds-tag>
                        </div>

                             <!--<ng-template #contentAddtag>
                                <div class="w-[304px]">
                                    <tds-form-field>
                                        <tds-select valueField="Id" textField="Name" placeholder='Chọn chiến dịch'
                                            [(ngModel)]="currentLiveCampaign" [data]="lstOfLiveCampaign"
                                            [ngModelOptions]="{standalone: true}"
                                            [allowClear]="true" [valuePrimitive]="false" [autoClose]="false">
                                        </tds-select>
                                    </tds-form-field>
                                </div>
                              </ng-template>

                            <ng-template #footerAddTag>
                                <div class="flex justify-end pt-2">
                                  <button tds-button-icon type="button" color="secondary" class="mr-2" size="sm" (click)="closeTag()">
                                    <span class="flex items-center">
                                      <i class="tdsi-close-fill"></i>
                                    </span>
                                  </button>
                                  <button tds-button-icon type="button" size="sm" color="primary" (click)="updateFacebookByLiveCampaign()">
                                    <span class="flex items-center">
                                      <i class="tdsi-tick-fill"></i>
                                    </span>
                                  </button>
                                </div>
                            </ng-template>
                        </div> -->

                    </div>
                    <div class="post-picture w-1/4 flex justify-end" *ngIf="(data.Data | facebookType).picture">
                        <img [src]="(data.Data | facebookType).picture" class="rounded-xl h-[122px] object-cover" />
                    </div>

                </div>

                <!-- TShop -->
                <div class="post-body flex flex-row justify-between p-4" *ngIf="team.Type == 'TShop'">
                    <div class="flex flex-col justify-between gap-y-3">
                        <div class="w-full flex flex-col gap-y-3">
                            <p class="italic text-neutral-1-900 text-caption-1">
                                {{ (data.Data | tshopType).Content?.Text || '(Chưa có nội dung tiêu đề)' }}
                            </p>
                        </div>
                    </div>

                    <div class="post-picture" *ngIf="(data.Data | tshopType).MediaLive?.ThumbnailUrl">
                        <img [src]="(data.Data | tshopType).MediaLive?.ThumbnailUrl" class="rounded-xl h-[122px] object-cover" />
                    </div>
              </div>

                <div class="post-footer bg-neutral-3-50 text-neutral-1-600 font-regular flex flex-row items-center justify-between py-1 px-4 gap-x-2">
                    <container-element [ngSwitch]="indClickFilter" class="w-full">

                        <!-- lọc tất cả bình luận -->
                        <ng-container *ngSwitchCase="0" class="w-full">
                            <div class="emotion-count flex flex-row items-center flex-auto justify-between w-full">
                                <div class="flex gap-x-2">
                                    <div class="flex flex-row">
                                        <img src="../../../assets/imagesv2/conversation/like-circle.svg" width="20px" height="20px"
                                            class="rounded-full z-50">
                                        <img src="../../../assets/imagesv2/conversation/love-circle.svg" width="20px" height="20px"
                                            class="rounded-full z-40 -ml-2">
                                    </div>
                                    <span> {{(data.Data | facebookType).count_reactions || 0}} </span>
                                </div>
                                <div class="flex gap-x-3">
                                    <span class="comment-count"> {{(data.Data | facebookType).count_comments || 0}} bình luận </span>
                                    <span class="share-count  mr-3"> {{(data.Data | facebookType).count_shares || 0}} lượt chia sẻ </span>
                                </div>
                            </div>
                        </ng-container>

                        <!-- lọc người dùng -->
                        <ng-container *ngSwitchCase="1" class="w-full">
                            <button *ngIf="!isShowFilterUser; else showFilterUser" tds-button size="sm" color="primary" rounded="!rounded-full" (click)="onShowFilterUser()">
                                <span class="flex items-center text-caption-1">
                                    <i class="tdsi-success-line text-[20px] leading-none mr-2"></i>Thao tác
                                </span>
                            </button>

                            <ng-template #showFilterUser>
                                <div class="flex gap-x-3 items-center">
                                    <tds-checkbox class="pr-2" (change)="onAllChecked($event)" [indeterminate]="indeterminate" [checked]="checked"></tds-checkbox>
                                    <button tds-button color="primary" size="sm">
                                        <span class="flex items-center">
                                            <i class="tdsi-messenger-fill text-lg leading-none mr-2"></i>Gửi tin nhắn
                                        </span>
                                    </button>
                                    <button tds-button color="info" size="sm">
                                        <span class="flex items-center">
                                            <i class="tdsi-print-fill text-lg leading-none mr-2"></i>In thông tin
                                        </span>
                                    </button>
                                    <button tds-button color="error" size="sm" rounded="!rounded-full" (click)="onShowFilterUser()">
                                        <span class="flex items-center">
                                            <i class="tdsi-close-fill text-lg leading-none mr-2"></i>Đóng
                                        </span>
                                    </button>
                                </div>
                            </ng-template>
                        </ng-container>

                        <!-- quản lý bình luận -->
                        <ng-container *ngSwitchCase="2" class="w-full">
                            <div class="flex gap-x-3 items-center">
                                <tds-checkbox class="pr-2" (change)="onAllChecked($event)" [indeterminate]="indeterminate" [checked]="checked"></tds-checkbox>
                                <button tds-button color="primary" size="sm">
                                    <span class="flex items-center">
                                        <i class="tdsi-eye-close-fill text-lg leading-none mr-2"></i>Ẩn
                                    </span>
                                </button>
                                <button tds-button color="primary" size="sm">
                                    <span class="flex items-center">
                                        <i class="tdsi-eye-open-fill text-lg leading-none mr-2"></i>Hiện
                                    </span>
                                </button>
                                <button tds-button color="error" size="sm">
                                    <span class="flex items-center">
                                        <i class="tdsi-trash-fill text-lg leading-none mr-2"></i>Xóa
                                    </span>
                                </button>
                            </div>
                        </ng-container>

                        <ng-container *ngSwitchCase="3" class="w-full">
                            <div class="flex w-full gap-x-3" >
                                <tds-form-field class="2xl:w-[270px] w-auto">
                                    <span tdsPrefix><i class="tdsi-search-fill"></i></span>
                                    <input tdsInput placeholder="Tìm kiếm" autocomplete="off" [tdsInputDebounce]="500" (inputKeyup)="onSearchFilterComment()"
                                    [(ngModel)]="innerText" [ngModelOptions]="{standalone: true}" />
                                </tds-form-field>
                                <tds-form-field class="w-[160px]">
                                    <tds-select valueField="value" textField="text" placeholder='Chọn thuộc tính'
                                        [(ngModel)]="currentFilterComment" [valuePrimitive]="false"
                                        [data]="filterOptionsComment" (ngModelChange)="onChangeFilterComment($event)" >
                                    </tds-select>
                                </tds-form-field>
                            </div>
                        </ng-container>
                    </container-element>

                    <div class="flex flex-row items-center gap-3">
                        <!-- filter -->
                        <div *ngFor="let item of filterOptions; let index = index" (click)="fillterAll(item, index)"
                            [ngClass]="indClickFilter == index ?'bg-primary-3 text-primary-1 border border-primary-1':'border border-transparent'"
                            class="h-[30px] w-[30px] rounded-md cursor-pointer" tds-tooltip [tooltipTitle]="item.text">
                            <span class="flex items-center justify-center">
                                <i class="{{item.icon}} text-xl"></i>
                            </span>
                        </div>
                        <button *ngIf="currentSort.text == 'Mới nhất'; else cmtOld" class="h-[30px] w-[30px] rounded-md cursor-pointer" tds-tooltip tooltipTitle="Bình luận mới nhất nhất" (click)="onChangeSort(sortOptions[1])">
                            <i class="tdsi-sort-arrow-up-fill text-xl text-primary-1"></i>
                        </button>
                        <ng-template #cmtOld>
                            <button class="h-[30px] w-[30px] rounded-md cursor-pointer" tds-tooltip tooltipTitle="Bình luận cũ nhất" (click)="onChangeSort(sortOptions[0])">
                                <i class="tdsi-sort-arrow-down-fill text-xl text-primary-1"></i>
                            </button>
                        </ng-template>
                    </div>
                </div>
            </div>
        </div>
        <!-- Danh sách bình luận -->
        <div class="flex w-full flex-auto overflow-hidden">
            <tds-spin [spinning]="isLoading" class="flex-auto h-full w-full flex overflow-hidden">
                <div  class="flex w-full h-full overflow-hidden" *ngIf="data && !isLoading">
                    <div *ngIf="currentFilter.value === 'all'" class="h-full w-full">
                        <!-- <post-comment-all
                            [postId]="data.ObjectId"
                            [data]="objComment"
                            [team]="team"
                            [childs]="childs"
                            [commentOrders]="commentOrders">
                        </post-comment-all> -->

                        <comment-filter-all [data]="data" [team]="team" [commentOrders]="commentOrders">
                        </comment-filter-all>
                    </div>

                    <!-- <div *ngIf="currentFilter.value === 'group'" class="h-full w-full">
                        <post-comment-group
                            [postId]="data.ObjectId"
                            [data]="objComment"
                            [team]="team"
                            [childs]="childs"
                            [commentOrders]="commentOrders"
                            [isShowFilterUser]="isShowFilterUser">
                        </post-comment-group>
                    </div>

                    <div *ngIf="currentFilter.value === 'filter'" class="h-full w-full">
                        <post-comment-filter
                            [currentFilterComment]="currentFilterComment"
                            [textSearchFilterComment]="textSearchFilterComment">
                        </post-comment-filter>
                    </div>

                    <div *ngIf="currentFilter.value === 'manage'" class="h-full w-full">
                        <manage-post-comment></manage-post-comment>
                    </div> -->
                </div>
            </tds-spin>

        </div>
    </div>

</div>
