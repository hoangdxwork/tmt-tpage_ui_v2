<tds-spin [spinning]="isLoading">
  <div class="w-full h-full flex overflow-hidden flex-col gap-y-4 overflow-y-auto tds-custom-scroll bg-white p-4">
    <div class="flex gap-x-2">
        <tds-form-field class="w-full">
            <input tdsInput placeholder="Tìm kiếm đơn hàng" autocomplete="off" (keydown.enter)="applyFilter($event)"/>
            <span tdsPrefix><i class="text-neutral-1-500 tdsi-search-fill"></i></span>
        </tds-form-field>
        <button tds-button color="primary" tds-dropdown trigger="click"
            [tdsDropdownMenu]="manipulation" [disabled]="isLoadingActive">
            <span class="flex items-center">
                {{ !isLoadingActive ? 'Thao tác' : 'Loading...' }} <i class="tdsi-arrow-down-fill text-lg leading-none ml-2"></i>
            </span>
        </button>
        <!-- dropdown thao tác -->
        <tds-dropdown-menu #manipulation="tdsDropdownMenu">
            <div class="w-full">
                <div tds-dropdown-item *ngFor="let item of lstActive" (click)="onActive(item.value)">
                    <a> {{ item.text }} </a>
                </div>
            </div>
        </tds-dropdown-menu>
    </div>
    <div class="flex">
        <tds-filter-status [ngModel]='tabIndex' (selectChange)="onSelectChange($event)">
          <ng-template ngFor let-item [ngForOf]="tabNavs" let-i="index">
            <tds-filter-status-item [name]='item.Name' [count]='item.Total' [value]="item.Index">
              <ng-template tds-filter-status-template let-active='active'
                    let-count='count' let-name='name' let-value>
                    <div class="py-1 px-2 flex items-center border border-neutral-2-100 border-solid rounded-full mr-2"
                        [ngClass]="{' border-primary-1':active,'border-neutral-2-100 group-hover:border-primary-1':!active}">
                        <div class="text-body-2 px-2 font-semibold truncate" [ngClass]="{'text-primary-1':active,'text-neutral-1-400 group-hover:text-primary-1':!active}">
                            {{name}}&nbsp; {{count}}
                        </div>
                    </div>
                </ng-template>
            </tds-filter-status-item>
          </ng-template>
        </tds-filter-status>
    </div>
    <div class="flex flex-col gap-y-4">
        <tds-collapse accordion="true">
            <tds-collapse-panel [header]="headerOrder" [active]="false" *ngFor="let order of lstOfData" (activeChange)="onActiveChange(order, $event)"
                [extra]="extraTpl1">
                <!-- Header  -->
                <ng-template #headerOrder>
                  <div class="flex gap-x-8 items-center z-10">
                      <div class="flex flex-col">
                          <div>
                              <span class="text-info-500 font-semibold">#{{ order.Code || 'N/A' }}</span>
                          </div>
                          <div>
                              <span class="text-neutral-1-400 text-caption-2"> {{ order.DateCreated | date:"HH:mm, dd/MM/yyyy " }} </span>
                          </div>
                      </div>
                      <div class="flex flex-col justify-between">
                          <div>
                              <span class="">{{ order.Facebook_UserName }}</span>
                          </div>
                          <div class="flex items-center">
                              <button *ngIf="order.Telephone"
                                  class="bg-green-400 rounded h-4 w-4 flex items-center justify-center mr-1">
                                  <span class="flex items-center text-white">
                                      <i class="tdsi-call-fill text-[10px] leading-[10px]"></i>
                                  </span>
                              </button>
                              <button *ngIf="order.Address"
                                  class="bg-orange-500 rounded h-4 w-4 flex items-center justify-center mr-2">
                                  <span class="flex items-center text-white">
                                      <i class="tdsi-pin-fill text-[10px] leading-[10px]"></i>
                                  </span>
                              </button>
                              <div>
                                  <span class="text-error-400 text-caption-2" *ngIf="!order.PrintCount || order.PrintCount == 0">
                                    Chưa in
                                  </span>

                                  <span class="text-success-500 text-caption-2" *ngIf="order.PrintCount && order.PrintCount > 0">
                                    Đã in: {{order.PrintCount}}
                                  </span>
                              </div>
                          </div>
                      </div>
                      <tds-badge status="secondary" text="{{ order.StatusText }}"></tds-badge>
                  </div>
                </ng-template>
                <ng-template #extraTpl1>
                  <div class="flex gap-x-6 items-center">
                      <button tds-flat-button-icon (click)="onEdit(order)">
                          <span class="flex items-center">
                              <i class="tdsi-edit-fill"></i>
                          </span>
                      </button>
                      <tds-checkbox (change)="onCheck(order.Id, $event)"></tds-checkbox>
                  </div>
                </ng-template>
                <!-- Content  -->
                <div class="w-full">
                    <tds-table #tableInCollapse [listData]="lstLine" [loading]="isLoadingLine" [showPagination]="false">
                        <thead>
                            <tr>
                                <th>Sản phẩm</th>
                                <th>Số lượng</th>
                                <th>Thành tiền</th>
                                <th>Trạng thái</th>
                            </tr>
                        </thead>
                        <tbody>
                            <ng-template ngFor let-data [ngForOf]="tableInCollapse.data">
                                <tr>
                                    <td>
                                        <div class="flex flex-col">
                                            <span>{{data.ProductNameGet}}</span>
                                            <span>{{data.Price | number}}</span>
                                        </div>
                                    </td>
                                    <td>{{ data.Quantity | number }}</td>
                                    <td>{{ data.Quantity * data.Price | number }}</td>
                                    <td>
                                        <div class="flex">
                                            <div class="py-1 px-4 rounded text-white font-semibold"
                                            [ngClass]="data.IsOrderPriority == true?'bg-primary-1':'bg-neutral-1-300 text'">
                                                <span>{{data.IsOrderPriority == true?'Ưu tiên':'Dự bị'}}</span>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            </ng-template>
                        </tbody>
                    </tds-table>
                </div>
            </tds-collapse-panel>
        </tds-collapse>
    </div>
  </div>
</tds-spin>

