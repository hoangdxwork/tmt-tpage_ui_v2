<div class="flex flex-col gap-y-4 text-body-2 h-[calc(65vh)] overflow-hidden p-1">
    <div class="flex gap-x-2.5">
        <tds-form-field class="w-full">
            <input tdsInput class="text-neutral-1-600" placeholder="Tìm kiếm" autocomplete="off"
            [(ngModel)]="searchText" [ngModelOptions]="{standalone: true}" [tdsInputDebounce]="750" (inputKeyup)="searchBill()"/>
            <span tdsPrefix><i class="text-neutral-1-600 tdsi-search-fill"></i></span>
        </tds-form-field>
        <button tds-button color="primary" tds-dropdown trigger="click" [tdsDropdownMenu]="menu">
            <span class="flex items-center">
                Sắp xếp
                <i class="tdsi-arrow-down-fill text-lg leading-none ml-2"></i>
            </span>
        </button>
        <tds-dropdown-menu #menu="tdsDropdownMenu">
            <div class="w-40">
                <div *ngFor="let item of sortOptions" tds-dropdown-item (click)="switchSort(item.value)" class="flex items-center justify-between">
                    <a> {{item.text}} </a>
                    <span class="tdsi-success-fill text-success-500" *ngIf="item.value == searchSelect"></span>
                </div>
            </div>
        </tds-dropdown-menu>
    </div>

    <div class="flex flex-col flex-auto">
        <tds-table class="!h-auto" #basicTable [listData]="lstBillofPartner" [showPagination]="false" [pageSize]="lstBillofPartner.length">
            <thead>
                <tr>
                    <th width="154px">Mã phiếu</th>
                    <th width="154px">Ngày tạo</th>
                    <th width="154px">Tổng tiền</th>
                    <th width="154px">Trạng thái</th>
                    <th width="140px">Thông tin</th>
                    <th width="200px">Thanh toán</th>
                    <th class="text-center">Thao tác</th>
                </tr>
            </thead>
        </tds-table>
        <tds-spin [spinning]="isLoading" class="flex flex-col overflow-hidden overflow-y-auto w-full h-full">
            <virtual-scroller *ngIf="lstBillofPartner && lstBillofPartner.length > 0; else noData"
                #scroll [items]="lstBillofPartner" class="tds-custom-scroll w-full h-full"
                (vsEnd)="vsEnd($event)"
                [enableUnequalChildrenSizes]="true"
                [scrollAnimationTime]="750">
                    <div *ngFor="let data of scroll.viewPortItems; let i = index" class="p-2 flex items-center border-b border-b-neutral-3-100 hover:bg-neutral-3-50">
                        <div class="w-[154px] p-2">
                            <span class="text-accent-9">{{data.Number}}</span>
                        </div>
                        <div class="w-[154px] p-2">{{data.DateCreated | date:'dd/MM/yyyy'}}</div>
                        <div class="w-[154px] p-2">{{data.AmountTotal || 0 | numberCustom }} đ</div>
                        <div class="w-[154px] p-2">
                            <tds-tag [status]='data.ShowState | getColorStatusShowState'>{{data.ShowState}}</tds-tag>
                        </div>
                        <div class="w-[140px] p-2">
                            <div>
                                <button tds-flat-button color="secondary" rounded="!rounded-full" (click)="showModalDetailBill(data)">
                                    <span class="flex items-center text-info-500">
                                        <i class="tdsi-edit-fill text-xl leading-5 mr-2"></i>Chi tiết
                                    </span>
                                </button>
                            </div>
                        </div>
                        <div class="w-[154px] p-2">
                            <button tds-button color="secondary" tds-dropdown [backdrop]="true" trigger="click" [tdsDropdownMenu]="menu">
                                <span class="flex items-center">
                                    {{data.PaymentMethod || "Chưa có PTTT"}}
                                    <i class="tdsi-arrow-down-fill text-lg leading-none ml-2"></i>
                                </span>
                            </button>
                            <tds-dropdown-menu #menu="tdsDropdownMenu">
                                <div class="w-full">
                                    <div *ngFor="let item of (lstPaymentJournals | async) || []" tds-dropdown-item (click)="selectPayment(i, item.Name)">
                                        {{item.Name}}
                                    </div>
                                </div>
                            </tds-dropdown-menu>
                        </div>
                        <div class="flex-auto p-2 gap-x-2 flex justify-end">
                            <button tds-button-icon color="secondary" (click)="showModalSendMessage(data)" tds-tooltip tooltipTitle="Gửi mẫu facebook">
                                <span class="flex items-center text-neutral-1-500">
                                    <i class="tdsi-facebook-2-fill"></i>
                                </span>
                            </button>
                            <!-- <button tds-button-icon color="secondary" (click)="confirmSubmit(data)" tds-tooltip tooltipTitle="Gửi yêu cầu thanh toán">
                                <span class="flex items-center text-neutral-1-500">
                                    <i class="tdsi-send-fill"></i>
                                </span>
                            </button> -->
                            <button tds-button-icon color="secondary" (click)="onSendImage(data)" tds-tooltip tooltipTitle="Gửi hình ảnh">
                                <span class="flex items-center text-neutral-1-500">
                                    <i class="tdsi-images-fill"></i>
                                </span>
                            </button>
                        </div>
                    </div>
            </virtual-scroller>
            <ng-template #noData>
                <div  class="w-full">
                    <tds-empty></tds-empty>
                </div>
            </ng-template>
        </tds-spin>
    </div>
</div>
<div class="w-full flex justify-end p-4" *tdsModalFooter>
    <button tds-button class="mr-2 min-w-[100px]" color="secondary" (click)="cancel()">Đóng</button>
</div>
