<tds-spin [spinning]="isLoading">
  <div class="w-full h-full">
    <tds-tabset [(selectedIndex)]="tabIndex">
        <!-- Tất cả -->
        <tds-tab title="Tất cả">
            <div class="flex flex-col h-full w-full">
                <div class="flex items-center gap-2.5">
                    <tds-form-field class="w-full">
                        <input aria-colspan="" class="placeholder-neutral-1-400" placeholder="Tìm kiếm hình ảnh" tdsInput (keyup.enter)="onSearch($event)" />
                        <span tdsPrefix ><i class="text-neutral-1-500 tdsi-search-fill text-base"></i></span>
                    </tds-form-field>
                    <tds-upload [beforeUpload]="beforeUpload">
                      <button tds-button color="primary">
                        <span class="flex items-center">
                            <i class="tdsi-upload-fill text-lg leading-none mr-2"></i>Tải ảnh lên
                        </span>
                      </button>
                    </tds-upload>
                </div>
                <div class="py-5 flex items-center justify-between">
                    <div class="flex gap-5 items-center">
                        <tds-checkbox (change)="checkAll($event.checked)">Chọn tất cả</tds-checkbox>
                        <div class="text-body-2 font-regular text-neutral-1-900 font-sans">Số ảnh đã chọn
                          <span class="pl-1 text-primary-1 font-bold"> {{ numberSelect }} </span>
                        </div>
                    </div>
                    <button tds-button color="error" (click)="removeAttachmentChecked()">
                        <span class="flex items-center">
                          <i class="tdsi-trash-line text-lg leading-none mr-2"></i>Xóa ảnh
                        </span>
                      </button>
                </div>
                <div class="max-h-[calc(100vh-375px)] h-[calc(100vh-375px)] w-full overflow-y-auto tds-custom-scroll">
                    <div class="grid grid-cols-4 gap-5 h-full w-full">
                        <ng-template ngFor let-data [ngForOf]="(lstAll || (lstAll$ | async))?.Items">
                            <div *ngIf="data.Select === false; else noActive">
                                <div class="relative rounded-lg border border-transparent border-solid group">
                                    <div class="absolute top-1 right-1 opacity-0 group-hover:opacity-100">
                                        <tds-checkbox [(ngModel)]="data.Select" (change)="checkValue(data)"></tds-checkbox>
                                    </div>
                                    <img [src]="data.Url">
                                    <div class="absolute bottom-0 opacity-0 group-hover:opacity-100 w-full">
                                        <div class="flex p-2.5 gap-2.5 bg-gradient-to-b from-black/0 to-black/100 items-center rounded-b-lg justify-between">
                                            <div class="text-body-2 text-white font-semibold font-sans"> {{ data.Name }} </div>
                                            <div class="flex gap-0.5">
                                                <div class="flex items-center">
                                                  <i class="tdsi-edit-fill text-sm text-white leading-none p-1.5 bg-inherit hover:bg-neutral-3-50/9 rounded-md"></i>
                                                </div>

                                                <div class="flex items-center" tds-flat-button-icon tds-tooltip tooltipTitle="Thêm vào bộ sưu tập">
                                                  <i class="tdsi-add-fill text-sm text-white leading-none p-1.5 bg-inherit hover:bg-neutral-3-50/9 rounded-md"></i>
                                                </div>

                                                <div class="flex items-center" (click)="removeAttachment(data.id)">
                                                  <i class="tdsi-trash-fill text-sm text-white leading-none p-1.5 bg-inherit hover:bg-neutral-3-50/9 rounded-md"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <ng-template #noActive>
                                <div class="relative rounded-lg border border-primary-1 border-solid group">
                                    <div class="absolute top-1 right-1 opacity-100">
                                        <tds-checkbox [(ngModel)]="data.Select" (change)="checkValue(data)"></tds-checkbox>
                                    </div>
                                    <img [src]="data.Url">
                                    <div class="absolute bottom-0 opacity-0 group-hover:opacity-100 w-full">
                                        <div class="flex p-2.5 gap-2.5 bg-gradient-to-b from-black/0 to-black/100 items-center rounded-b-lg justify-between">
                                            <div class="text-body-2 text-white font-semibold font-sans"> {{ data.Name }} </div>
                                            <div class="flex gap-0.5">
                                                <div class="flex items-center">
                                                  <i class="tdsi-edit-fill text-sm text-white leading-none p-1.5 bg-inherit hover:bg-neutral-3-50/9 rounded-md"></i>
                                                </div>

                                                <div class="flex items-center" tds-flat-button-icon tds-tooltip tooltipTitle="Thêm vào bộ sưu tập">
                                                  <i class="tdsi-add-fill text-sm text-white leading-none p-1.5 bg-inherit hover:bg-neutral-3-50/9 rounded-md"></i>
                                                </div>

                                                <div class="flex items-center" (click)="removeAttachment(data.id)">
                                                  <i class="tdsi-trash-fill text-sm text-white leading-none p-1.5 bg-inherit hover:bg-neutral-3-50/9 rounded-md"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                              </ng-template>
                        </ng-template>
                    </div>
                </div>
            </div>
        </tds-tab>
        <!-- Bộ sưu tập -->
        <tds-tab title="Bộ sưu tập">
            <div class="flex flex-col h-full w-full">
                <div class="flex items-center gap-2.5">
                    <tds-form-field class="w-full">
                        <input aria-colspan="" class="placeholder-neutral-1-400" placeholder="Tìm kiếm hình ảnh" tdsInput (keyup.enter)="onSearch($event)" />
                        <span tdsPrefix ><i class="text-neutral-1-500 tdsi-search-fill text-base"></i></span>
                    </tds-form-field>
                    <button tds-button color="primary" (click)="showModalAddCollection()">
                        <span class="flex items-center">
                            <i class="tdsi-add-fill text-lg leading-none mr-2"></i>Tạo mới bộ sưu tập
                        </span>
                    </button>
                </div>
                <div class="py-5 flex items-center justify-between">
                    <div class="flex gap-5 items-center">
                        <tds-checkbox>Chọn tất cả</tds-checkbox>
                        <div class="text-body-2 font-regular text-neutral-1-900 font-sans">
                          Số bộ sưu tập đã chọn <span class="pl-1 text-primary-1 font-bold"> {{ numberSelectColl }} </span>
                        </div>
                    </div>
                    <button tds-button color="error" (click)="removeCollectionChecked()">
                        <span class="flex items-center">
                          <i class="tdsi-trash-line text-lg leading-none mr-2"></i>Xóa bộ sưu tập
                        </span>
                      </button>
                </div>
                <div class="max-h-[calc(100vh-375px)] w-full overflow-y-auto tds-custom-scroll">
                    <div class="grid grid-cols-3 gap-5 ">
                        <ng-template ngFor let-data [ngForOf]="lstColl$ | async">
                            <div *ngIf="data.Select === false; else noCollectActive">
                                <div class="relative rounded-lg border border-transparent border-solid group">
                                    <div class="absolute top-2 right-1 opacity-0 group-hover:opacity-100">
                                        <tds-checkbox [(ngModel)]="data.Select"></tds-checkbox>
                                    </div>
                                    <div class="flex gap-1 rounded-lg items-center">
                                        <ng-template ngFor let-att [ngForOf]="data.Attachments" let-index="index">
                                            <div class="w-3/5 rounded-l-lg" *ngIf="index == 0">
                                                <img [src]="att.Url" class="rounded-l-lg">
                                            </div>
                                            <div class="w-2/5 flex flex-col gap-1 rounded-r-lg">
                                                <img [src]="att.Url" class="h-[145px] rounded-tr-lg" *ngIf="index == 1">
                                                <img [src]="att.Url" class="h-[145px] rounded-br-lg" *ngIf="index == 2">
                                            </div>
                                        </ng-template>
                                    </div>
                                    <div class="absolute bottom-0 right-0 left-0 opacity-0 group-hover:opacity-100">
                                        <div class="flex p-2.5 gap-2.5 bg-gradient-to-b from-black/0 to-black/100 items-center rounded-b-lg justify-between w-full">
                                            <div class="flex flex-col gap-1">
                                                <div class="text-caption-1 font-regular text-white font-sans">Bộ sưu tập - {{ 0 }} ảnh</div>
                                                <div class="text-body-2 text-white font-semibold font-sans">{{ data.Name }}</div>
                                            </div>
                                            <div class="flex gap-0.5">
                                                <div class="flex items-center">
                                                  <i class="tdsi-edit-fill text-sm text-white leading-none p-1.5 bg-inherit hover:bg-neutral-3-50/9 rounded-md"></i>
                                                </div>

                                                <div class="flex items-center" (click)="removeCollection(data.id)">
                                                  <i class="tdsi-trash-fill text-sm text-white leading-none p-1.5 bg-inherit hover:bg-neutral-3-50/9 rounded-md"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <ng-template #noCollectActive>
                                <div class="relative rounded-lg border border-transparent border-solid group">
                                    <div class="absolute top-2 right-1 opacity-100">
                                        <tds-checkbox [(ngModel)]="data.Select"></tds-checkbox>
                                    </div>
                                    <div class="flex gap-1 rounded-lg items-center">
                                        <ng-template ngFor let-att [ngForOf]="data.Attachments" let-index="index">
                                            <div class="w-3/5 rounded-l-lg" *ngIf="index == 0">
                                                <img [src]="att.Url" class="rounded-l-lg">
                                            </div>
                                            <div class="w-2/5 flex flex-col gap-1 rounded-r-lg">
                                                <img [src]="att.Url" class="h-[145px] rounded-tr-lg" *ngIf="index == 1">
                                                <img [src]="att.Url" class="h-[145px] rounded-br-lg" *ngIf="index == 2">
                                            </div>
                                        </ng-template>
                                    </div>
                                    <div class="absolute bottom-0 right-0 left-0 opacity-0 group-hover:opacity-100">
                                        <div class="flex p-2.5 gap-2.5 bg-gradient-to-b from-black/0 to-black/100 items-center rounded-b-lg justify-between w-full">
                                            <div class="flex flex-col gap-1">
                                                <div class="text-caption-1 font-regular text-white font-sans">Bộ sưu tập - {{ 0 }} ảnh</div>
                                                <div class="text-body-2 text-white font-semibold font-sans">{{ data.Name }}</div>
                                            </div>
                                            <div class="flex gap-0.5">
                                                <div class="flex items-center">
                                                  <i class="tdsi-edit-fill text-sm text-white leading-none p-1.5 bg-inherit hover:bg-neutral-3-50/9 rounded-md"></i>
                                                </div>

                                                <div class="flex items-center" (click)="removeCollection(data.id)">
                                                  <i class="tdsi-trash-fill text-sm text-white leading-none p-1.5 bg-inherit hover:bg-neutral-3-50/9 rounded-md"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                              </ng-template>
                        </ng-template>
                    </div>
                </div>
            </div>
        </tds-tab>
    </tds-tabset>
    <div class="w-full flex justify-end p-4" *tdsModalFooter>
        <button tds-button class="mr-2 w-[100px]" color="secondary" (click)="onCancel()">Hủy bỏ</button>
        <button tds-button class="w-[100px]" type="submit" color="primary">Gửi</button>
    </div>
  </div>
</tds-spin>

