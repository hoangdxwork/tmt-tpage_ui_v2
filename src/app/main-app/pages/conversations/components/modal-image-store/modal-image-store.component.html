<tds-spin [spinning]="isLoading">
  <div class="w-full h-full">
    <tds-tabset [(selectedIndex)]="tabIndex">
        <!-- Tất cả -->
        <tds-tab title="Tất cả">
            <div class="flex flex-col h-full w-full">
                <div class="flex items-center gap-2.5">
                    <tds-form-field class="w-full">
                        <input aria-colspan="" class="placeholder-neutral-1-400" placeholder="Tìm kiếm hình ảnh" tdsInput (keyup.enter)="onSearch($event)" />
                        <span tdsPrefix ><i class="text-neutral-1-500 tdsi-search-fill text-base"></i></span>
                    </tds-form-field>
                    <tds-upload [beforeUpload]="beforeUpload">
                      <button tds-button color="primary">
                        <span class="flex items-center">
                            <i class="tdsi-upload-fill text-lg leading-none mr-2"></i>Tải ảnh lên
                        </span>
                      </button>
                    </tds-upload>
                </div>
                <div class="py-5 flex items-center justify-between">
                    <div class="flex gap-5 items-center">
                        <tds-checkbox (change)="checkAllAttachment($event.checked)">Chọn tất cả</tds-checkbox>
                        <div class="text-body-2 font-regular text-neutral-1-900 font-sans">Số ảnh đã chọn
                          <span class="pl-1 text-primary-1 font-bold"> {{ numberSelect }} </span>
                        </div>
                    </div>
                    <button tds-button color="error" (click)="removeAttachmentChecked()">
                        <span class="flex items-center">
                          <i class="tdsi-trash-line text-lg leading-none mr-2"></i>Xóa ảnh
                        </span>
                    </button>
                </div>
                <div class="max-h-[calc(100vh-375px)] h-[calc(100vh-375px)] w-full overflow-y-auto tds-custom-scroll">
                    <div class="grid grid-cols-4 gap-5 h-full w-full" *ngIf="(lstAll$ | async)?.Items; else lstAllNoData">
                        <ng-template ngFor let-data [ngForOf]="(lstAll || (lstAll$ | async))?.Items">
                            <div *ngIf="!data.Select; else noActive">
                                <div class="relative rounded-lg border border-transparent border-solid group flex items-center h-[230px] justify-center">
                                    <div class="absolute top-1 right-1 opacity-0 group-hover:opacity-100">
                                        <tds-checkbox [(ngModel)]="data.Select" (change)="checkValue(data)"></tds-checkbox>
                                    </div>
                                    <img [src]="data.Url" class="w-auto h-auto max-w-full max-h-full">
                                    <div class="absolute bottom-0 opacity-0 group-hover:opacity-100 w-full">
                                        <div class="flex p-2.5 gap-2.5 bg-gradient-to-b from-black/0 to-black/100 items-center rounded-b-lg justify-between">
                                            <div class="text-body-2 text-white font-semibold font-sans"> {{ data.Name }} </div>
                                            <div class="flex gap-0.5">
                                                <div class="flex items-center">
                                                  <i class="tdsi-edit-fill text-sm text-white leading-none p-1.5 bg-inherit hover:bg-neutral-3-50/9 rounded-md"></i>
                                                </div>

                                                <div class="flex items-center" tds-flat-button-icon tds-tooltip tooltipTitle="Thêm vào bộ sưu tập"
                                                  (click)="showModalAddAttachmentCollection()">
                                                  <i class="tdsi-add-fill text-sm text-white leading-none p-1.5 bg-inherit hover:bg-neutral-3-50/9 rounded-md"></i>
                                                </div>

                                                <div class="flex items-center" (click)="removeAttachment(data.id)">
                                                  <i class="tdsi-trash-fill text-sm text-white leading-none p-1.5 bg-inherit hover:bg-neutral-3-50/9 rounded-md"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <ng-template #noActive>
                                <div class="relative rounded-lg border border-primary-1 border-solid group flex items-center h-[230px] justify-center">
                                    <div class="absolute top-1 right-1 opacity-100">
                                        <tds-checkbox [(ngModel)]="data.Select" (change)="checkValue(data)"></tds-checkbox>
                                    </div>
                                    <img [src]="data.Url" class="w-auto h-auto max-w-full max-h-full">
                                    <div class="absolute bottom-0 opacity-0 group-hover:opacity-100 w-full">
                                        <div class="flex p-2.5 gap-2.5 bg-gradient-to-b from-black/0 to-black/100 items-center rounded-b-lg justify-between">
                                            <div class="text-body-2 text-white font-semibold font-sans"> {{ data.Name }} </div>
                                            <div class="flex gap-0.5">
                                                <div class="flex items-center">
                                                  <i class="tdsi-edit-fill text-sm text-white leading-none p-1.5 bg-inherit hover:bg-neutral-3-50/9 rounded-md"></i>
                                                </div>

                                                <div class="flex items-center" tds-flat-button-icon tds-tooltip tooltipTitle="Thêm vào bộ sưu tập"
                                                  (click)="showModalAddAttachmentCollection()">
                                                  <i class="tdsi-add-fill text-sm text-white leading-none p-1.5 bg-inherit hover:bg-neutral-3-50/9 rounded-md"></i>
                                                </div>

                                                <div class="flex items-center" (click)="removeAttachment(data.id)">
                                                  <i class="tdsi-trash-fill text-sm text-white leading-none p-1.5 bg-inherit hover:bg-neutral-3-50/9 rounded-md"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                              </ng-template>
                        </ng-template>
                    </div>
                    <ng-template #lstAllNoData>
                      <div class="flex flex-col items-center justify-center w-full">
                        <img src="../../../assets/imagesv2/attachment/no-data.svg" class="my-4 py-2.5">
                        <span class="text-neutral-1-400 text-body-2 font-regular text-center font-sans pb-6">Không có dữ liệu</span>
                      </div>
                    </ng-template>
                </div>
            </div>
        </tds-tab>
        <!-- Bộ sưu tập -->
        <tds-tab title="Bộ sưu tập">
            <div class="flex flex-col h-full w-full">
                <div class="flex items-center gap-2.5">
                    <tds-form-field class="w-full">
                        <input aria-colspan="" class="placeholder-neutral-1-400" placeholder="Tìm kiếm hình ảnh" tdsInput (keyup.enter)="onSearch($event)" />
                        <span tdsPrefix ><i class="text-neutral-1-500 tdsi-search-fill text-base"></i></span>
                    </tds-form-field>
                    <button tds-button color="primary" (click)="showModalAddCollection()">
                        <span class="flex items-center">
                            <i class="tdsi-add-fill text-lg leading-none mr-2"></i>Tạo mới bộ sưu tập
                        </span>
                    </button>
                </div>
                <div class="py-5 flex items-center justify-between">
                    <div class="flex gap-5 items-center">
                        <tds-checkbox (change)="checkAllCollection($event.checked)">Chọn tất cả</tds-checkbox>
                        <div class="text-body-2 font-regular text-neutral-1-900 font-sans">
                          Số bộ sưu tập đã chọn <span class="pl-1 text-primary-1 font-bold"> {{ numberSelectColl }} </span>
                        </div>
                    </div>
                    <button tds-button color="error" (click)="removeCollectionChecked()">
                        <span class="flex items-center">
                          <i class="tdsi-trash-line text-lg leading-none mr-2"></i>Xóa bộ sưu tập
                        </span>
                      </button>
                </div>
                <div class="max-h-[calc(100vh-375px)] h-[calc(100vh-375px)] w-full overflow-y-auto tds-custom-scroll">
                    <div class="grid grid-cols-3 gap-5" *ngIf="(lstColl$ | async); else lstCollNoData">
                        <ng-template ngFor let-data [ngForOf]="(lstColl$ | async)">
                            <div *ngIf="!data.Select; else noCollectActive" (click)="showModalListCollection(data.id, data.Name)">
                                <div class="relative rounded-lg border border-transparent border-solid group flex items-center h-[316px]">
                                    <div class="absolute top-2 right-1 opacity-0 group-hover:opacity-100">
                                        <tds-checkbox [(ngModel)]="data.Select" (change)="checkValueCollection(data)"></tds-checkbox>
                                    </div>
                                    <div class="flex rounded-lg items-center gap-1" *ngIf="data.Attachments">
                                      <div class="w-3/5 rounded-l-lg" *ngIf="data.Attachments[0]">
                                          <img [src]="data.Attachments[0].Url" class="rounded-l-lg" onerror="this.scr='../../../assets/imagesv2/attachment/images-empty.svg'">
                                      </div>
                                      <div class="w-2/5 flex flex-col gap-1 rounded-r-lg" *ngIf="data.Attachments && data.Attachments[1]">
                                          <img [src]="data.Attachments[1].Url" class="h-[145px] rounded-tr-lg"
                                          onerror="this.scr='../../../assets/imagesv2/attachment/images-empty.svg'">
                                          <img [src]="data.Attachments[2].Url" class="h-[145px] rounded-br-lg" *ngIf="data.Attachments && data.Attachments[2]"
                                          onerror="this.scr='../../../assets/imagesv2/attachment/images-empty.svg'">
                                      </div>
                                    </div>
                                    <div class="flex w-full rounded-lg items-center justify-center" *ngIf="!data.Attachments">
                                      <div class="rounded-l-lg">
                                          <img [src]="'../../../assets/imagesv2/attachment/images-empty.svg'" class="rounded-l-lg">
                                          <p class="font-normal mb-6 text-sm text-neutral-1-400 text-center">Chưa có ảnh</p>
                                      </div>
                                    </div>
                                    <div class="absolute bottom-0 right-0 left-0 opacity-0 group-hover:opacity-100">
                                        <div class="flex p-2.5 gap-2.5 bg-gradient-to-b from-black/0 to-black/100 items-center rounded-b-lg justify-between w-full">
                                            <div class="flex flex-col gap-1">
                                                <div class="text-caption-1 font-regular text-white font-sans">Bộ sưu tập - {{ 0 }} ảnh</div>
                                                <div class="text-body-2 text-white font-semibold font-sans">{{ data.Name }}</div>
                                            </div>
                                            <div class="flex gap-0.5">
                                                <div class="flex items-center">
                                                  <i class="tdsi-edit-fill text-sm text-white leading-none p-1.5 bg-inherit hover:bg-neutral-3-50/9 rounded-md"></i>
                                                </div>

                                                <div class="flex items-center" (click)="removeCollection(data.id)">
                                                  <i class="tdsi-trash-fill text-sm text-white leading-none p-1.5 bg-inherit hover:bg-neutral-3-50/9 rounded-md"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <ng-template #noCollectActive>
                                <div class="relative rounded-lg border border-transparent border-solid group flex items-center h-[316px]">
                                    <div class="absolute top-2 right-1 opacity-100">
                                        <tds-checkbox [(ngModel)]="data.Select" (change)="checkValueCollection(data)"></tds-checkbox>
                                    </div>
                                    <div class="flex rounded-lg items-center gap-1" *ngIf="data.Attachments">
                                        <div class="w-3/5 rounded-l-lg" *ngIf="data.Attachments[0]">
                                            <img [src]="data.Attachments[0].Url" class="rounded-l-lg" onerror="this.scr='../../../assets/imagesv2/attachment/images-empty.svg'">
                                        </div>
                                        <div class="w-2/5 flex flex-col gap-1 rounded-r-lg" *ngIf="data.Attachments && data.Attachments[1]">
                                            <img [src]="data.Attachments[1].Url" class="h-[145px] rounded-tr-lg"
                                            onerror="this.scr='../../../assets/imagesv2/attachment/images-empty.svg'">
                                            <img [src]="data.Attachments[2].Url" class="h-[145px] rounded-br-lg" *ngIf="data.Attachments && data.Attachments[2]"
                                            onerror="this.scr='../../../assets/imagesv2/attachment/images-empty.svg'">
                                        </div>
                                    </div>
                                    <div class="flex w-full rounded-lg items-center justify-center" *ngIf="!data.Attachments">
                                        <div class="rounded-l-lg">
                                            <img [src]="'../../../assets/imagesv2/attachment/images-empty.svg'" class="rounded-l-lg">
                                            <p class="font-normal mb-6 text-sm text-neutral-1-400 text-center">Chưa có ảnh</p>
                                        </div>
                                    </div>
                                    <div class="absolute bottom-0 right-0 left-0 opacity-0 group-hover:opacity-100">
                                        <div class="flex p-2.5 gap-2.5 bg-gradient-to-b from-black/0 to-black/100 items-center rounded-b-lg justify-between w-full">
                                            <div class="flex flex-col gap-1">
                                                <div class="text-caption-1 font-regular text-white font-sans">Bộ sưu tập - {{ 0 }} ảnh</div>
                                                <div class="text-body-2 text-white font-semibold font-sans">{{ data.Name }}</div>
                                            </div>
                                            <div class="flex gap-0.5">
                                                <div class="flex items-center">
                                                  <i class="tdsi-edit-fill text-sm text-white leading-none p-1.5 bg-inherit hover:bg-neutral-3-50/9 rounded-md"></i>
                                                </div>

                                                <div class="flex items-center" (click)="removeCollection(data.id)">
                                                  <i class="tdsi-trash-fill text-sm text-white leading-none p-1.5 bg-inherit hover:bg-neutral-3-50/9 rounded-md"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                              </ng-template>
                        </ng-template>
                    </div>
                    <ng-template #lstCollNoData>
                      <div class="flex flex-col items-center justify-center w-full">
                        <img src="../../../assets/imagesv2/attachment/no-data.svg" class="my-4 py-2.5">
                        <span class="text-neutral-1-400 text-body-2 font-regular text-center font-sans pb-6">Không có dữ liệu</span>
                      </div>
                    </ng-template>
                </div>
            </div>
        </tds-tab>
    </tds-tabset>
    <div class="w-full flex justify-end p-4" *tdsModalFooter>
        <button tds-button class="mr-2 w-[100px]" color="secondary" (click)="onCancel()">Hủy bỏ</button>
        <button tds-button class="w-[100px]" type="submit" color="primary">Gửi</button>
    </div>
  </div>
</tds-spin>

