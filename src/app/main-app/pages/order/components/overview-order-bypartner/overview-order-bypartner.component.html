<tds-spin [spinning]="isLoading" class="w-full h-full">
  <div class="w-full flex flex-col gap-y-4">
    <div class="w-full flex gap-x-4">
      <tds-form-field class="w-full">
        <input tdsInput placeholder="Tìm kiếm đơn hàng" autocomplete="off" [tdsInputDebounce]="750"
          (inputKeyup)="onSearch($event)" />
        <span tdsPrefix><i class="text-neutral-1-500 tdsi-search-fill"></i></span>
      </tds-form-field>

      <div class="w-96">
        <tds-range-picker [(ngModel)]="datePicker" (ngModelChange)="onChangeDate($event)"> </tds-range-picker>
      </div>
    </div>
    <div class="border rounded-md border-neutral-2-200 pb-2.5">
      <tds-filter-status [ngModel]='tabIndex' (selectChange)="onSelectChange($event)" class="px-4">
        <ng-template ngFor let-item [ngForOf]="tabNavs" let-i="index">
          <tds-filter-status-item [name]='item.Name' [count]='item.Total' [value]="item.Index">
          </tds-filter-status-item>
        </ng-template>
      </tds-filter-status>
      <div class="xl:max-h-[320px] xl:h-[320px]">
        <tds-table class="w-full h-full" [scroll]="{ y:'auto' }" #productTable 
          [showSizeChanger]="true" [frontPagination]="false"
          [listData]="lstOrder" [(pageIndex)]="pageIndex"
          [(pageSize)]="pageSize" [total]="count" (queryParams)="onQueryParamsChange($event)">
          <thead class="rounded">
            <tr>
              <th [width]="'48px'" class="text-center">STT</th>
              <th [width]="'140px'">Số HĐ</th>
              <th [width]="'140px'">
                <div class="flex gap-x-1">
                  <span>Ngày tạo đơn</span>
                  <span class=" flex flex-col p-0.5 cursor-pointer" (click)="onChangeFilterDate()" tds-tooltip [tooltipTitle]="filterDate | sortDateName">
                    <i [ngClass]="filterDate | sortDateClass" class="text-primary-1 tdsi-sort-up-down-fill active text-base leading-4"></i>
                  </span>
                </div>
              </th>
              <th [width]="'150px'">Đối tác giao hàng</th>
              <th [width]="'120px'">Mã vận đơn</th>
              <th [width]="'113px'" [align]="'right'">Tổng tiền</th>
              <th [width]="'113px'" [align]="'right'">Còn nợ</th>
              <th [width]="'120px'">Trạng thái</th>
            </tr>
          </thead>
          <tbody>
            <ng-template ngFor let-data [ngForOf]="productTable.data" let-index="index">
              <tr>
                <!-- STT -->
                <td class="text-center">{{ index | numericalOrder: pageSize: pageIndex }}</td>

                <!-- Số HĐ -->
                <td>
                  <div class="w-full flex font-semibold cursor-pointer"
                    (click)="onBillDetail($event, data)">
                    <span [ngClass]="data.Number ? 'text-info-400' : 'text-error-500'">{{ data.Number || 'N/A' }}</span>
                  </div>
                  <!-- Nhãn -->
                </td>

                <!-- Ngày tạo đơn -->
                <td>
                  <div class="w-full">
                    <span>{{ data.DateCreated | yiDateTimeFormat }}</span>
                  </div>
                </td>

                <!-- Đối tác GH -->
                <td>
                  <div class="w-full">
                    <span class="text-info-400 font-semibold">{{ data.ShowShipStatus }}</span>
                  </div>
                </td>

                <!-- Mã vận đơn -->
                <td>
                  <div class="w-full">
                    <span class="text-info-400 font-semibold" (click)="onOpenTrackingUrl(data)">{{ data.TrackingRef }}</span>
                  </div>
                </td>

                <!-- Tổng tiền -->
                <td>
                  <div class="w-full" [align]="'right'">
                    <span>{{ data.AmountTotal || 0 | numberCustom  }} đ</span>
                  </div>
                </td>

                <!-- Còn nợ -->
                <td>
                  <div class="w-full" [align]="'right'">
                    <span>{{ data.Residual || 0 | numberCustom  }} đ</span>
                  </div>
                </td>

                <!-- Trạng thái -->
                <td>
                  <div class="w-full">
                    <tds-tag *ngIf="data.State ==='draft'" status='secondary' type="outline">{{
                      data.ShowState }}
                    </tds-tag>
                    <tds-tag *ngIf="data.State ==='paid'" status='primary' type="outline">{{
                      data.ShowState }}</tds-tag>
                    <tds-tag *ngIf="data.State ==='open'" status='info' type="outline">{{ data.ShowState
                      }}
                    </tds-tag>
                    <tds-tag *ngIf="data.State ==='cancel'" status='error' type="outline">{{
                      data.ShowState }}</tds-tag>
                    <p *ngIf="data.PaymentMessageCount" class="text-neutral-1-400 text-xs pt-2">Đã gửi
                      yêu cầu thanh toán</p>
                  </div>
                </td>
              </tr>
            </ng-template>
          </tbody>
        </tds-table>
      </div>
    </div>
  </div>
</tds-spin>
