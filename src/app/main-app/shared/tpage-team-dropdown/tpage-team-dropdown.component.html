<ng-container *ngIf="parentIsHeaderCpm; else conversation">
    <div class="w-full flex items-center justify-center" tds-dropdown [clickHide]="false" [(visible)]="visible"
        [tdsDropdownMenu]="dropdownTeam" trigger="click">
        <div>
            <tpage-avatar-facebook [fbid]="currentTeam?.Facebook_PageId || currentTeam?.Facebook_ASUserId"
                [token]="currentTeam?.Facebook_PageToken || currentTeam?.Facebook_UserToken">
            </tpage-avatar-facebook>
        </div>
        <div class="px-2  flex-auto text-body-2 font-regular text-d-neutral-1-700 truncate">
            {{currentTeam?.Name}}
        </div>
        <div class="text-d-neutral-1-700">
            <i class="text-base leading-4 tdsi-arrow-down-fill"></i>
        </div>
    </div>
</ng-container>
<ng-template #conversation>
    <div class="w-full cursor-pointer border-2 border-neutral-2-50 border-solid rounded-lg py-2.5 px-3.5 flex justify-center items-center">
        <div tds-dropdown [clickHide]="false" [(visible)]="visible" [tdsDropdownMenu]="dropdownTeam" trigger="click" class="flex-auto flex items-center">
           <div class="w-full flex items-center">
            <div>
                <tpage-avatar-facebook [fbid]="currentTeam?.Facebook_PageId || currentTeam?.Facebook_ASUserId"
                    [token]="currentTeam?.Facebook_PageToken || currentTeam?.Facebook_UserToken">
                </tpage-avatar-facebook>
            </div>
            <div class="flex-auto flex pr-4">
                <div class="flex-auto relative  font-regular text-neutral-1-900">
                   <div class="absolute inset-0 pl-3 pr-1 text-body-2 truncate">
                    {{currentTeam?.Name}}
                   </div>
                </div>
                <div class="text-neutral-1-400">
                    <i class="text-base leading-4 tdsi-arrow-down-line"></i>
                </div>

            </div>
           </div>
        </div>
        <button tds-button-flat-icon color="secondary" rounded="!rounded-full" class="p-1 hover:bg-info-100" (click)="onRefresh()">
            <svg [ngClass]="isRefreshing?'animate-spin':''" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M7.62005 4.08293C7.85778 3.98571 8.10098 3.90247 8.34842 3.83363C9.54248 3.50676 10.8061 3.536 11.9838 3.91776C13.1616 4.29952 14.2023 5.01716 14.9779 5.98247C15.7535 6.94778 16.2303 8.1187 16.3496 9.3513C16.469 10.5839 16.2257 11.8245 15.6497 12.9205L14.9502 12.5245C14.8733 12.4803 14.7861 12.4574 14.6975 12.4581C14.6088 12.4588 14.522 12.4831 14.4459 12.5284C14.3736 12.5772 14.315 12.6436 14.2756 12.7215C14.2363 12.7993 14.2175 12.8859 14.2211 12.973C14.2277 13.0731 14.0555 16.4624 14.045 16.2523C14.0512 16.3323 14.0767 16.4096 14.1195 16.4775C14.1622 16.5454 14.2209 16.6019 14.2903 16.642C14.3598 16.6821 14.438 16.7047 14.5182 16.7078C14.5983 16.7109 14.678 16.6944 14.7503 16.6597C14.8403 16.6154 18.12 14.9962 17.932 15.0888C18.0111 15.05 18.078 14.9902 18.1256 14.9161C18.1733 14.8419 18.1997 14.7562 18.2022 14.6681C18.2046 14.58 18.183 14.4929 18.1395 14.4162C18.0961 14.3395 18.0326 14.2761 17.9558 14.2329L17.3773 13.8916C18.1317 12.4568 18.4516 10.8332 18.298 9.21931C18.1444 7.60542 17.524 6.07121 16.5125 4.80433C15.5011 3.53745 14.1425 2.59282 12.6029 2.08597C11.0634 1.57913 9.40958 1.53204 7.84383 1.95046L7.825 1.95551C7.55888 2.02682 7.35671 2.09383 7.20316 2.15057C7.10422 2.18686 7.01968 2.2542 6.96218 2.34253C6.90468 2.43087 6.87731 2.53545 6.88415 2.64064L6.9504 3.66143C6.95557 3.73835 6.97885 3.81296 7.01833 3.87917C7.05781 3.94539 7.11238 4.00133 7.17758 4.04244C7.24278 4.08356 7.31677 4.10868 7.39351 4.11575C7.47026 4.12283 7.54759 4.11166 7.61919 4.08316L7.62005 4.08293Z" fill="#CDD3DB"/>
                <path d="M13.1184 17.3652L13.0555 16.3398C13.0506 16.2626 13.0275 16.1876 12.988 16.1211C12.9486 16.0546 12.8939 15.9983 12.8285 15.957C12.7631 15.9157 12.6888 15.8905 12.6118 15.8835C12.5348 15.8765 12.4572 15.8878 12.3854 15.9166C12.1458 16.0138 11.9007 16.0969 11.6514 16.1656C10.4579 16.4915 9.19507 16.4613 8.01835 16.0787C6.84163 15.6961 5.80234 14.9778 5.02834 14.0122C4.25435 13.0465 3.7794 11.8756 3.66197 10.6436C3.54453 9.41155 3.78971 8.17211 4.36735 7.07775L5.05746 7.47632C5.13433 7.52046 5.22154 7.54336 5.31016 7.54267C5.39878 7.54198 5.48561 7.51772 5.56176 7.47239C5.63409 7.42368 5.69273 7.35723 5.73208 7.27939C5.77144 7.20155 5.79019 7.11491 5.78655 7.02775C5.77992 6.92769 5.95216 3.53838 5.96259 3.74844C5.95813 3.66746 5.93319 3.58894 5.89008 3.52025C5.84697 3.45156 5.78711 3.39496 5.71613 3.35575C5.64645 3.31457 5.56758 3.29143 5.4867 3.28843C5.40582 3.28543 5.32548 3.30266 5.25295 3.33857L2.10293 4.90098C2.02341 4.94078 1.95625 5.00153 1.90867 5.07667C1.86109 5.15182 1.83491 5.23853 1.83293 5.32746C1.82982 5.41488 1.85123 5.50144 1.89474 5.57733C1.93826 5.65322 2.00213 5.71543 2.07914 5.7569L2.65315 6.08842C1.88736 7.52045 1.55726 9.14538 1.70353 10.7629C1.84981 12.3805 2.46607 13.9199 3.47635 15.1915C4.48663 16.4631 5.84678 17.4113 7.38912 17.9191C8.93147 18.427 10.5886 18.4723 12.1563 18.0496L12.1845 18.042C12.3933 17.9861 12.5966 17.9233 12.7965 17.8514C12.8957 17.8156 12.9805 17.7486 13.0384 17.6605C13.0963 17.5723 13.1241 17.4679 13.1177 17.3626L13.1184 17.3652Z" fill="#CDD3DB"/>
                </svg>
        </button>
    </div>
</ng-template>
<tds-dropdown-menu #dropdownTeam="tdsDropdownMenu">
    <ng-container *ngIf="parentIsHeaderCpm; else dropDownconversation">
        <div class="w-80 max-h-[500px] overflow-hidden overflow-y-auto tds-panel-scroll">
            <div class="w-full py-1">
                <ng-container *ngIf="data$ | async as data">
                    <tds-collapse [expandIconPosition]="'right'" [bordered]="false">
                        <ng-template ngFor let-item [ngForOf]="data.Items" let-i="index">
                            <tds-collapse-panel [header]="headerTpl" [active]="true" [disabled]="false"
                                [expandedIcon]="'tdsi-arrow-up-line'" [tdsClass]="'p-0'">
                                <ng-template #headerTpl>
                                    <div class="w-full flex items-center justify-center">
                                        <div>
                                            <tpage-avatar-facebook
                                                [fbid]="item.Facebook_PageId || item.Facebook_ASUserId"
                                                [token]="item.Facebook_PageToken || item.Facebook_UserToken">
                                            </tpage-avatar-facebook>
                                        </div>
                                        <div class="flex-auto pl-4 text-body-2 font-semibold">
                                            {{item.Name}}
                                        </div>
                                    </div>
                                </ng-template>
                                <ng-template ngFor let-child [ngForOf]="item.Childs" let-i="index">
                                    <div class="w-full px-6 cursor-pointer" (click)="onClick($event,child)">
                                        <div class="flex items-center justify-center p-2" [ngClass]="{
                                            'bg-neutral-3-50 rounded-full': currentTeam?.Id == child.Id
                                        }">
                                            <div>
                                                <tpage-avatar-facebook size="sm"
                                                    [fbid]="child.Facebook_PageId || child.Facebook_ASUserId"
                                                    [token]="child.Facebook_PageToken || child.Facebook_UserToken">
                                                </tpage-avatar-facebook>
                                            </div>
                                            <div class="flex-auto pl-4 text-body-2 ">
                                                {{child.Name}}
                                            </div>
                                            <div *ngIf="currentTeam?.Id == child.Id">
                                                <span
                                                    class="text-xl leading-5 tdsi-success-fill text-success-400"></span>
                                            </div>
                                        </div>
                                    </div>
                                </ng-template>



                            </tds-collapse-panel>
                        </ng-template>
                    </tds-collapse>
                </ng-container>
            </div>
        </div>
    </ng-container>

</tds-dropdown-menu>
<ng-template #dropDownconversation>
    <div class="w-full py-1 max-h-[500px] overflow-hidden overflow-y-auto tds-panel-scroll">
        <ng-container *ngIf="data$ | async as data">
            <tds-collapse [expandIconPosition]="'right'" [bordered]="false">
                <ng-template ngFor let-item [ngForOf]="data.Items" let-i="index" let-last="last">
                    <tds-collapse-panel [header]="headerTpl" [active]="true" [disabled]="false"
                        [expandedIcon]="'tdsi-arrow-up-line'" [tdsClass]="last ? '' :'p-0 pb-2 border-b-2 border-neutral-2-50'">
                        <ng-template #headerTpl>
                            <div class="w-full flex items-center justify-center ">
                                <div>
                                    <tpage-avatar-facebook [fbid]="item.Facebook_PageId || item.Facebook_ASUserId"
                                        [token]="item.Facebook_PageToken || item.Facebook_UserToken">
                                    </tpage-avatar-facebook>
                                </div>
                                <div class="flex-auto pl-4 text-body-2 font-semibold">
                                    {{item.Name}}
                                </div>
                            </div>
                        </ng-template>
                        <ng-template ngFor let-child [ngForOf]="item.Childs" let-i="index">
                            <div class="w-full px-6 cursor-pointer" (click)="onClick($event,child)">
                                <div class="flex items-center justify-center p-2" [ngClass]="{
                                    'bg-neutral-3-50 rounded-full': currentTeam?.Id == child.Id
                                }">
                                    <div>
                                        <tds-badge [count]="iconTemplate1">
                                            <tpage-avatar-facebook size="sm"
                                                [fbid]="child.Facebook_PageId || child.Facebook_ASUserId"
                                                [token]="child.Facebook_PageToken || child.Facebook_UserToken">
                                            </tpage-avatar-facebook>
                                        </tds-badge>
                                        <ng-template #iconTemplate1>
                                            <div class="absolute top-0 left-4   flex items-center justify-center ">
                                                <div class="rounded-full border border-white">
                                                    <span class="block bg-accent-3 w-2 h-2 rounded-full "></span>
                                                </div>
                                            </div>
                                        </ng-template>
                                    </div>
                                    <div class="flex-auto pl-4 text-body-2 ">
                                        {{child.Name}}
                                    </div>
                                    <div *ngIf="currentTeam?.Id == child.Id">
                                        <span class="text-xl leading-5 tdsi-success-fill text-success-400"></span>
                                    </div>
                                </div>
                            </div>
                        </ng-template>
                    </tds-collapse-panel>
                </ng-template>
            </tds-collapse>
        </ng-container>
    </div>
</ng-template>
