<tds-spin [spinning]="isLoading" class="text-body-2 text-neutral-1-900 flex h-[670px] overflow-hidden">
  <div *ngIf="!isNoPost" class="flex justify-between gap-x-2 items-center p-4">
    <tds-tag *ngIf="dataLiveCampaign" status="bg-base-orange-50 text-base-orange-500 inline-flex"
      style="border: 1px solid #f3deba; width: fit-content; border-radius: 5px;">
      <span class="flex items-center py-0.5 cursor-pointer max-w-[450px]" >
          <span class="text-body-2 font-regular flex-auto truncate mr-2">{{ dataLiveCampaign.Name }}</span>
          <span class="text-neutral-1-400 font-regular text-sm w-fit">{{dataLiveCampaign.DateCreated | date : "dd/MM/yyyy HH:mm"}}</span>
      </span>
    </tds-tag>

    <div *ngIf="dataLiveCampaign?.Id" class="flex gap-x-3">
        <button tds-button color="primary" size="md" class="flex items-center"
            (click)="showModalChangeLiveCampaign()">
            <span class="flex items-center gap-x-2">
                <span class="tdsi-in-out-fill text-lg"></span>
                <span>Đổi chiến dịch</span>
            </span>
        </button>

        <button tds-button color="primary" size="md" class="flex items-center" (click)="showModelEditLiveCampaign(dataLiveCampaign?.Id)">
          <span class="flex items-center gap-x-2">
            <span class="tdsi-edit-fill text-lg"></span>
            <span>Chỉnh sửa</span>
          </span>
        </button>

        <button tds-button color="error" size="md" class="flex items-center" (click)="removeLiveCampaign()" tds-tooltip tooltipTitle="Bỏ chọn chiến dịch">
            <span class="flex items-center gap-x-2">
              <span class="tdsi-trash-fill text-lg"></span>
              <span>Xóa</span>
            </span>
        </button>

    </div>
  </div>
  
  <tds-tabset class="!h-full" [tabBarStyle]="{'padding-right':'0px','padding-left':'0px'}" *ngIf="dataOverviewReport">
    <tds-tab [title]="overview" clsContent="p-4 border-t border-neutral-2-200" [clsContent]="'w-full h-full'">
      <ng-template #overview let-active="active">
        <div class="flex gap-x-2 items-center justify-center">
          <div class="flex items-center font-semibold cursor-pointer text-body-2 px-3 py-4 relative group"
            [ngClass]='{"text-neutral-1-900 dark:text-d-neutral-1-900":active,"text-neutral-1-400 dark:text-d-neutral-1-400 hover:text-neutral-1-900 hover:dark:text-d-neutral-1-900":!active}'>

            <span  class="font-semibold mr-2">Tổng quan</span>

            <div [ngClass]="{'block':active,'hidden group-hover:block':!active}"
              class="hidden border-b-3 border-primary-1 absolute left-0 right-0 bottom-0 bg-primary-1">
            </div>

          </div>
        </div>
      </ng-template>
      <div class="flex flex-col w-full h-full">

        <div class="flex-auto bg-neutral-3-50 grid grid-cols-4 gap-4 gap-y-9 p-4">
          <div class="flex flex-col bg-white p-4 rounded-xl gap-y-3" *ngIf="dataOverviewReport.OrderSummary">
            <div>
              <tds-avatar tdsSrc="../../../assets/imagesv2/live-campaign/product.svg" [size]="48" [shape]="'square'" [isAvatar]="false"></tds-avatar>
            </div>
  
            <span class="text-header-1 font-semibold">Chờ chốt</span>
            <div class="flex flex-col items-end gap-2 w-full">
              <div class="flex w-full justify-between items-center gap-x-2">
                <span class="text-body-2 text-neutral-1-500 text-left">Số lượng đơn</span>
                <span class="text-header-1 font-semibold text-right">{{ dataOverviewReport.OrderSummary.OrderQuantity || 0 }}</span>
              </div>
              
              <div class="flex w-full justify-between items-center gap-x-2">
                <span class="text-body-2 text-neutral-1-500 text-left">Số lượng sản phẩm</span>
                <span class="text-header-1 font-semibold text-right">{{ dataOverviewReport.OrderSummary.ProductQuantity || 0 }}</span>
              </div>
  
              <div class="flex w-full justify-between items-center gap-x-2">
                <span class="text-body-2 text-neutral-1-500 text-left">Tổng tiền</span>
                <span class="text-header-1 font-semibold text-right text-info-500">{{ (dataOverviewReport.OrderSummary.TotalAmount || 0) | numberCustom  }}</span>
              </div>
            </div>
          </div>
  
          <div class="flex flex-col bg-white p-4 rounded-xl gap-y-3" *ngIf="dataOverviewReport.BillSummary">
            <div>
              <tds-avatar tdsSrc="../../../assets/imagesv2/live-campaign/money.svg" [size]="48" [shape]="'square'" [isAvatar]="false"></tds-avatar>
            </div>
  
            <div class="flex flex-col flex-auto">
              <span class="text-header-1 font-semibold">Chờ thanh toán</span>
              <div class="flex flex-col items-end gap-2 w-full pt-3">
                <div class="flex w-full justify-between items-center gap-x-2">
                  <span class="w- text-body-2 text-neutral-1-500 text-left">Số lượng đơn</span>
                  <span class="text-header-1 font-semibold text-right">{{ dataOverviewReport.BillSummary.OrderQuantity || 0 }}</span>
                </div>
                
                <div class="flex w-full justify-between items-center gap-x-2">
                  <span class="text-body-2 text-neutral-1-500 text-left">Số lượng sản phẩm</span>
                  <span class="text-header-1 font-semibold text-right">{{ dataOverviewReport.BillSummary.ProductQuantity || 0 }}</span>
                </div>
  
                <div class="flex w-full justify-between items-center gap-x-2">
                  <span class="text-body-2 text-neutral-1-500 text-left">Tổng tiền</span>
                  <span class="text-header-1 font-semibold text-right text-info-500">{{ (dataOverviewReport.BillSummary.TotalAmount || 0) | numberCustom  }}</span>            
                </div>
              </div>
            </div>
          </div>
  
          <div class="flex flex-col bg-white p-4 rounded-xl gap-y-3" *ngIf="dataOverviewReport.PaySummary">
            <div>
              <tds-avatar tdsSrc="../../../assets/imagesv2/live-campaign/turnover.svg" [size]="48" [shape]="'square'" [isAvatar]="false"></tds-avatar>
            </div>
  
            <div class="flex flex-col flex-auto">
              <span class="text-header-1 font-semibold">Thanh toán</span>
              <div class="flex flex-col items-end gap-2 w-full pt-3">
                <div class="flex w-full justify-between items-center gap-x-2">
                  <span class="text-body-2 text-neutral-1-500 text-left">Số lượng đơn</span>
                  <span class="text-header-1 font-semibold text-right">{{ dataOverviewReport.PaySummary.OrderQuantity || 0 }}</span>
                </div>
                
                <div class="flex w-full justify-between items-center gap-x-2">
                  <span class="text-body-2 text-neutral-1-500 text-left">Số lượng sản phẩm</span>
                  <span class="text-header-1 font-semibold text-right">{{ dataOverviewReport.PaySummary.ProductQuantity || 0 }}</span>
                </div>
                
                <div class="flex w-full justify-between items-center gap-x-2">
                  <span class="text-body-2 text-neutral-1-500 text-left">Tổng tiền</span>
                  <span class="text-header-1 font-semibold text-right text-info-500">{{ (dataOverviewReport.PaySummary.TotalAmount || 0) | numberCustom  }}</span>
                </div>
              </div>
            </div>
          </div>
  
          <div class="flex flex-col bg-white p-4 rounded-xl gap-y-3" *ngIf="dataOverviewReport.TotalOrderBillSummary">
            <div>
              <tds-avatar tdsSrc="../../../assets/imagesv2/live-campaign/order.svg" [size]="48" [shape]="'square'" [isAvatar]="false"></tds-avatar>
            </div>
  
            <div class="flex flex-col flex-auto">
              <span class="text-header-1 font-semibold">Tổng hoá đơn</span>
              <div class="flex flex-col items-end gap-2 w-full pt-3">
                <div class="flex w-full justify-between items-center gap-x-2">
                  <span class="text-body-2 text-neutral-1-500 text-left">Số lượng đơn</span>
                  <span class="text-header-1 font-semibold text-right">{{  dataOverviewReport.TotalOrderBillSummary.OrderQuantity | numberCustom }}</span>
                </div>
                
                <div class="flex w-full justify-between items-center gap-x-2">
                  <span class="text-body-2 text-neutral-1-500 text-left">Số lượng sản phẩm</span>
                  <span class="text-header-1 font-semibold text-right">{{ dataOverviewReport.TotalOrderBillSummary.ProductQuantity | numberCustom }}</span>
                </div>
               
                <div class="flex w-full justify-between items-center gap-x-2">
                  <span class="text-body-2 text-neutral-1-500 text-left">Tổng tiền</span>
                  <span class="text-header-1 font-semibold text-right text-info-500">{{ dataOverviewReport.TotalOrderBillSummary.TotalAmount | numberCustom }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Thông tin -->
        <div class="flex-auto flex flex-col rounded-b-xl p-4">
          <div class="p-4 font-semibold text-xl rounded-t-xl">
            <span>Thông tin</span>
          </div>

          <div class="grid grid-cols-2 gap-4 p-4 bg-white">
            <div class="flex gap-x-4">
              <span class="w-1/3 text-sm font-normal">Tên chiến dịch</span>
              <span class="font-semibold text-sm">{{ dataLiveCampaign?.Name }}</span>
            </div>
            <div class="flex gap-x-4">
              <span class="w-1/3 text-sm font-normal">Nhân viên chốt đơn</span>
              <div *ngIf="dataLiveCampaign?.Users" class="text-body-2 font-semibold flex gap-x-2">
                <span *ngFor="let user of dataLiveCampaign.Users | slice: 0: 3; let i = index" >
                  {{user.Name}}
                  <span *ngIf="dataLiveCampaign.Users.length > (i + 1)">,</span>
                </span>
    
                <div class="px-1 py-0.5 text-info-500 bg-[#E5F2FF] text-caption-2 rounded cursor-pointer" *ngIf="dataLiveCampaign.Users.length - 3 > 0" tds-popover
                    [popoverContent]="popoverContentTag" popoverPlacement="topRight">
                    +{{dataLiveCampaign.Users.length - 3}}
                </div>
    
                <ng-template #popoverContentTag>
                    <div class="flex gap-1 flex-wrap items-center max-w-[336px]">
                        <div *ngFor="let item of dataLiveCampaign.Users | slice:3:dataLiveCampaign.Users!.length; let i = index" class="relative group flex items-center font-semibold text-body-2 text-neutral-1-900 rounded truncate">
                          {{item.Name }}
                          <span *ngIf="dataLiveCampaign.Users.length > (i + 4)">,</span>
                        </div>
                    </div>
                </ng-template>
              </div>
            </div>
            <div class="flex gap-x-4">
              <span class="w-1/3 text-sm font-normal">Facebook</span>
              <span class="font-semibold text-sm text-info-500">{{ dataLiveCampaign?.Facebook_UserName }}</span>
            </div>
            <div class="flex gap-x-4">
              <span class="w-1/3 text-sm font-normal">Trạng thái xác nhận chốt đơn</span>
              <div>
                <div class="flex items-center gap-x-2">
                  <tds-badge *ngIf="dataLiveCampaign" [status]="dataLiveCampaign!.ShowConfig | getColorShowConfig"></tds-badge>
                  <span class="font-semibold text-sm">{{ dataLiveCampaign?.ShowConfig }}</span>
                </div>
              </div>
            </div>
            <div class="flex gap-x-4">
              <span class="w-1/3 text-sm font-normal">Danh sách bài viết</span>
              <div class="flex items-center gap-x-2">
                <span (click)="showModalLstPost()" class="font-semibold text-sm text-info-400 cursor-pointer">{{facebookPosts.length + ' bài viết'}} </span>
              </div>
            </div>
            <div class="flex gap-x-4">
              <span class="w-1/3 text-sm font-normal">Ghi chú</span>
              <span class="font-semibold text-sm">{{ dataLiveCampaign?.Note }}</span>
            </div>
            <div class="flex gap-x-4">
              <span class="w-1/3 text-sm font-normal">Ngày tạo</span>
              <span class="font-semibold text-sm">{{ dataLiveCampaign?.DateCreated | date: 'dd/MM/yyyy HH:mm' }}</span>
            </div>
          </div>
        </div>
      </div>
      
    </tds-tab>

    <tds-tab [title]="productTitle" clsContent="border-t border-neutral-2-200"  clsContent="border-t pt-2 border-neutral-2-200 w-full h-full -mt-px">
      <ng-template #productTitle let-active="active">
        <div class="flex gap-x-2 items-center justify-center">
          <div class="flex items-center font-semibold cursor-pointer text-body-2 px-3 py-4 relative group"
            [ngClass]='{"text-neutral-1-900 dark:text-d-neutral-1-900":active,"text-neutral-1-400 dark:text-d-neutral-1-400 hover:text-neutral-1-900 hover:dark:text-d-neutral-1-900":!active}'>

            <span  class="font-semibold mr-2">Sản phẩm</span>

            <div class="text-caption-2 font-semibold py-0.5 px-1.5 rounded-full flex"
              [ngClass]="{'text-white bg-primary-1':active,'text-neutral-1-500 dark:text-d-neutral-1-500 bg-neutral-3-100 dark:bg-d-neutral-3-300  group-hover:text-white group-hover:bg-primary-1':!active}">
              {{dataLiveCampaign?.Details?.length}}
            </div>

            <div [ngClass]="{'block':active,'hidden group-hover:block':!active}"
              class="hidden border-b-3 border-primary-1 absolute left-0 right-0 bottom-0 bg-primary-1">
            </div>

          </div>
        </div>
      </ng-template>
      <div class="w-full h-full flex rounded-md">
        <table-detail-report [liveCampaignId]="liveCampaignId" [isShowEdit]="true" class="w-full h-full"></table-detail-report>
      </div>
    </tds-tab>
  </tds-tabset>

  <div class="w-full flex justify-end p-4 gap-x-2" *tdsModalFooter>
    <button tds-button class="w-[100px]" color="secondary" (click)="onCannel()">Đóng</button>
  </div>

</tds-spin>
